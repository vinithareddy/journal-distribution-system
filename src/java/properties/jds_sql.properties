# To change this template, choose Tools | Templates
# and open the template in the editor.
# To change this template, choose Tools | Templates
# and open the template in the editor.
# a comment
! a comment
#a = a string
#b = a string with escape sequences \t \n \r \\ \" \' \ (space) \u0123
#c = a string with a continuation line \
#    continuation line
#d.e.f = another string

#--------------------------------------------------------------------------
# Master Data
#--------------------------------------------------------------------------

! Generic ------------------------------------------------------

logged_in_user = select firstName, lastName, isPasswordReset from users where username = ?

purpose = select purpose from inward_purpose order by id

payment_mode = select payment_mode from payment_mode order by id

currency = select currency from currency order by id

return_reason = select return_reason from inward_return_reasons order by id

language = select language from languages order by id

month = select month from months order by id

journalname = select journalName from journals order by id

update_password = update users set password=?,isPasswordReset=? where username=?


! End Generic ------------------------------------------------------


! City ------------------------------------------------------
city = select city from cities

city_search = select city from cities where city like ?

search_city = select id, city from cities where city like ?

city_insert = insert into cities(city) values(?)

get_city_by_name = select id, city from cities where city = ?

get_city_by_id = select id, city from cities where id = ?

update_city = update cities set city = ? where id = ?

! End City----------------------------------------------------


!District ------------------------------------------------------
search_district = select id, district from districts where district like ?

district = select district from districts

district_insert = insert into districts(district) values(?)

get_district_by_name = select id, district from districts where district = ?

get_district_by_id = select id, district from districts where id = ?

update_district = update districts set district = ? where id = ?
! End District----------------------------------------------------


!State ------------------------------------------------------
search_state = select id, state from states where state like ?

state =  select state from states

state_insert = insert into states(state) values(?)

get_state_by_name = select id, state from states where state = ?

get_state_by_id = select id, state from states where id = ?

update_state = update states set state = ? where id = ?

! End State----------------------------------------------------



! Country------------------------------------------------------
country = select country from countries

country_insert = insert into countries(country) values(?)

get_country_by_name = select id, country from countries where country = ?

get_country_by_id = select id, country from countries where id = ?

update_country = update countries set country = ? where id = ?

search_country = select id, country from countries where country like ?
! End Country----------------------------------------------------


! Journal------------------------------------------------------
journals = select journalName,journalCode from journals

journal_groups = select id,journalGroupName from journal_groups order by id

journal_name = select journalName from journals

journalName = select journalName from journals

journal_insert = insert into journals(journalCode,journalName,issnNo,startYear) values(?,?,?,?)

update_journal = update journals set journalCode = ?, journalName = ?, issnNo = ?, startYear = ? where id = ?

get_journal_by_name = select id, journalCode, journalName, issnNo, startYear from journals where journalCode = ? and journalName = ? and issnNo = ? and startYear = ?

get_journal_by_id = select id, journalCode, journalName, issnNo, startYear from journals where id = ?

search_journal = select id, journalCode, journalName, issnNo, startYear from journals where journalCode like ? or journalName like ?

! End Journal----------------------------------------------------


! Subscriber Type------------------------------------------------------
subscriber_names = select distinct subscriberName from subscriber where subscriberName like ? LIMIT 100

department_names = select distinct department from subscriber where department like ? LIMIT 100

institution_names = select distinct institution from subscriber where institution like ? LIMIT 100

sub_type = select distinct subtype from subscriber_type

subscribertype = select subtypedesc as subscriberType from subscriber_type

subscribertype1 = select concat(subtypecode, '-',  subtypedesc) as subscriberType from subscriber_type

subtype_free = select distinct subtype from subscriber_type where subtype = "Free"

subtype_desc = select distinct subtypedesc from subscriber_type where subtype = ?

subtype_desc_asf = select distinct subtypedesc from subscriber_type where subtypedesc = "Summer Fellows"

subtype_code = select subtypecode from subscriber_type where subtypedesc = ?

subType_insert = insert into subscriber_type(subtypecode,subtypedesc,subtype,nationality,institutional,freejrnl,discount) values(?,?,?,?,?,?,?)

update_subType = update subscriber_type set subtypecode = ?, subtypedesc = ?, subtype = ?, nationality = ?, institutional = ?, freejrnl = ?, discount = ? where id = ?

get_subType_by_name = select id, subtypecode, subtypedesc, subtype, nationality, institutional, freejrnl, discount from subscriber_type where subtypecode = ? and subtypedesc = ? and subtype = ? and nationality = ? and institutional = ? and freejrnl = ? discount = ?

get_subType_by_id = select id, subtypecode, subtypedesc, subtype, nationality, institutional, freejrnl, discount from subscriber_type where id = ?

search_subType = select id, subtypecode, subtypedesc, subtype, nationality, institutional from subscriber_type where subtypecode like ? or subtype like ?

get_subscriber_type = select subtype from subscriber where subscriberNumber = ?

get_subscriber_type_for_id = select subtype from subscriber where id = ?

! End Subscriber Type----------------------------------------------------


! Agent------------------------------------------------------

agent = select agentName from agents

agentName = select agentName from agents

agent_insert = insert into agents(agentName,regDate,emailId,address,cityId,districtId,stateId,countryId,pinCode,discount)\
                values(?,?,?,?,(select id from cities where city = ?),(select id from districts where district = ?),\
                (select id from states where state = ?),(select id from countries where country = ?),?, ?)

update_agent = update agents set agentName = ?, regDate = ?, address = ?, emailId = ?, \
                cityId = (select id from cities where city = ?), \
                districtId = (select id from districts where district = ?), \
                stateId = (select id from states where state = ?), \
                countryId = (select id from countries where country = ?), \
                pinCode = ?, discount = ? where id = ?

get_agent_by_name = select agentId, agentName, regDate, emailId, address, cityId, districtId, stateId, CountryId, pinCode, discount from agents \
                    where agentName = ? and regDate = ? and emailId = ? and address = ? and \
                    cityId = (select id from cities where city = ?) and \
                    districtId = (select id from districts where district = ?) and  \
                    stateId = (select id from states where state = ?) and \
                    countryId = (select id from countries where country = ?) and \
                    pinCode = ? and discount = ?

!get_agent_by_id = select id, agentName, regDate, emailId, address, cityId, districtId, stateId, CountryId, pinCode, discount from agents where agentId = ?

get_agent_by_id = select t1.id\
                    ,t1.agentName \
                    ,t1.regDate \
                    ,t1.emailId \
                    ,t1.address \
                    ,t2.city \
                    ,t3.district \
                    ,t4.state \
                    ,t5.country \
                    ,t1.pinCode \
                    ,t1.discount \
                    from agents t1 \
                    left join cities t2 on t1.cityId = t2.id \
                    left join districts t3 on t1.districtId = t3.id \
                    left join states t4 on t1.stateId = t4.id \
                    left join countries t5 on t1.countryId = t5.id \
                    where t1.id = ?

search_agent = select t1.id ,t1.agentName ,t1.regDate ,t1.emailId ,t1.address ,t2.city from agents t1 \
                left join cities t2 on t1.cityId = t2.id \
                where t2.city like ? and  t1.agentName like ?

! End Agent----------------------------------------------------

!Print Order -----------------------------------------------------
get_year = select distinct(year) from print_order group by year

get_print_order_by_year = select t1.id, t2.journalCode, t2.journalName, \
                            t1.janPrintOrder, t1.febPrintOrder, t1.marPrintOrder, t1.aprPrintOrder, t1.mayPrintOrder, t1.junePrintOrder, \
                            t1.julyPrintOrder, t1.augPrintOrder, t1.septPrintOrder, t1.octPrintOrder, t1.novPrintOrder, t1.decPrintOrder , t1.annualPrintOrder \
                            from journals t2 left join print_order t1 on t2.id = t1.journalId and t1.`year`=?

!getNoOfIssues = select issues from journals where journalName = ?
getNoOfIssues = select issues from journal_details where journals_id = (select id from journals where journals.journalName = ? ) and year =?

!update_printOrder = update print_order set printOrder = ? where year = ? and journalId = (select id from journals where journalCode = ?)

!update_printOrder = update print_order set janPrintOrder = ?, febPrintOrder = ?, marPrintOrder = ?, aprPrintOrder = ?, \
!                    mayPrintOrder = ?, junePrintOrder = ?, julyPrintOrder = ?, augPrintOrder = ?, septPrintOrder = ?, \
!                    octPrintOrder = ?, novPrintOrder = ?, decPrintOrder = ?, annualPrintOrder = ? where id = ?

update_printOrder = update print_order set printOrder = ? where id = ?

!add_new_print_order = select id, journalCode, journalName, issues from journals

!get_printOrder = select printOrder from print_order where `year` = ? and journalId = ? and issueNo = ?
get_printOrder = select printOrder from print_order where `year` = ? and journalId = (select id from journals where journalName = ?) and issueNo = ?

!insert_printOrder = insert into print_order (year, journalID, \
!                    janPrintOrder, febPrintOrder, marPrintOrder, aprPrintOrder, mayPrintOrder, junePrintOrder, \
!                    julyPrintOrder, augPrintOrder, septPrintOrder, octPrintOrder, novPrintOrder, decPrintOrder, annualPrintOrder) \
!                    values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)
insert_printOrder = insert into print_order (`year`, journalId, issueNo, printOrder ) values (?,(select id from journals where journalName = ?),?,?)

get_journal_id = select id from journals where journalCode = ?

!get_print_order_id = select id from print_order where year = ? and journalId = (select id from journals where journalCode = ?)
get_print_order_id = select id from print_order where year = ? and journalId = (select id from journals where journalName = ?) and issueNo = ?
!End Print Order --------------------------------------------------------

!Journal Group -----------------------------------------------------
journalGroupName1 = select journalGroupName from journal_groups where year = ?

journalgroupname = select journalGroupName from journal_groups

getJournalGroupId = select id from journal_groups where journalGroupName = ?

getJournalGroupContents = select journalName from journals \
                            where id = ANY (select journalId from journal_group_contents \
                            where journalGroupId = (select id from journal_groups where journalGroupName = ?))

year = select year from year

createNewJournalGroup = insert into journal_groups(journalGroupName) values(?)

getJournalId = select id from journals where journalName = ?

addToJournalGroupContents = insert into journal_group_contents(journalGroupId, journalId) values((select id from journal_groups where journalGroupName = ?), (select id from journals where journalName = ?))

checkIfJournalGroupExists = select * from journal_groups where journalGroupName = ?

checkIfJournalGroupContentExists = select * from journal_group_contents where \
                                    journalGroupId = (select id from journal_groups where journalGroupName = ?) and \
                                    journalId = (select id from journals where journalName = ?)

!End Print Order --------------------------------------------------------

!Annual Subscription Rate------------------------------------------------------------------------
search_subRate = select t1.id, t2.journalGroupName, t3.subtypedesc, t1.year, t1.period, t1.rate from subscription_rates t1, journal_groups t2, subscriber_type t3 \
                   where t1.journalGroupId = t2.id and t1.subtypeId = t3.id and t1.year = ? and t2.journalGroupName = ? and t3.subtypedesc = ?

add_subRate = insert into subscription_rates (journalGroupId, subtypeId, year, period, rate) values \
                ((select id from journal_groups where journal_groups.journalGroupName = ?), \
                (select id from subscriber_type where subscriber_type.subtypedesc = ?),?,?,?)

check_subRate = select id from subscription_rates \
                where journalGroupId = (select id from journal_groups where journal_groups.journalGroupName = ?) and \
                subtypeId = (select id from subscriber_type where subscriber_type.subtypedesc = ?) and \
                year = ? and \
                period = ?



!End Annual Subscription Rate-------------------------------------------------------------------------------
#--------------------------------------------------------------------------
# End Master Data
#--------------------------------------------------------------------------

#--------------------------------------------------------------------------
# Inward
#--------------------------------------------------------------------------
insert_inward = insert into inward(\
                    inwardNumber,inward.from,country,state,district,city,pincode,email,institution,department,inwardCreationDate,subscriberId,inwardPurpose,\
                    paymentMode,bankName,chqddNumber,paymentDate,amount,currency,chequeDDReturn,chequeDDReturnReason,chequeDDReturnReasonOther,receiptNumber, \
                    ackDate,remarks, language\
                )values(?,?,\
                (select id from countries where country=?),\
                (select id from states where state=?),\
                (select id from districts where district=?),\
                (select id from cities where city=?),?,?,?,?,?,\
                (select id from subscriber where subscriberNumber=?),\
                (select id from inward_purpose where purpose=?),\
                (select id from payment_mode where payment_mode=?),?,?,?,?,\
                (select id from currency where currency=?),?,\
                (select id from inward_return_reasons where return_reason=?),?,?,?,?,\
                (select id from languages where language=?))

#insert_payment = insert into payment(inwardID, subscriptionID)values(?,?)

get_last_inward = SELECT inwardNumber,inwardCreationDate FROM inward ORDER BY id DESC LIMIT 1

get_inward_by_number = select t1.inwardNumber\
                      ,t1.id as InwardID \
                      ,t1.from \
                      ,t2.country \
                      ,t3.state \
                      ,t10.district \
                      ,t4.city \
                      ,t1.pincode \
                      ,t1.email \
                      ,t1.institution \
                      ,t1.department \
                      ,DATE_FORMAT(inwardCreationDate,'%d/%m/%Y') as inwardCreationDate \
                      ,t5.subscriberNumber as subscriberId \
                      ,t6.purpose as inwardPurpose \
                      ,t1.inwardPurpose as inwardPurposeID\
                      ,t7.payment_mode as paymentMode \
                      ,t1.chqddNumber \
                      ,DATE_FORMAT(t1.paymentDate,'%d/%m/%Y') as paymentDate \
                      ,t1.amount \
                      ,t8.currency \
                      ,t1.chequeDDReturn \
                      ,t9.return_reason as chequeDDReturnReason \
                      ,t1.chequeDDReturnReasonOther \
                      ,t1.receiptNumber \
                      ,DATE_FORMAT(t1.ackDate,'%d/%m/%Y') as ackDate \
                      ,t1.remarks \
                      ,t1.bankName \
                      ,DATE_FORMAT(t1.returnDate,'%d/%m/%Y') as returnDate \
                      ,t1.completed \
                      ,t11.language \
                      ,t14.agentName \
                      ,t5.email as subscriberemail \
                from inward t1 \
                    left join countries t2 on t1.country = t2.id \
                    left join states t3 on t1.state = t3.id \
                    left join districts t10 on t1.district = t10.id \
                    left join cities t4 on t1.city = t4.id \
                left join subscriber t5 on t1.subscriberId = t5.id \
                left join inward_purpose t6 on t1.inwardPurpose = t6.id \
                left join payment_mode t7 on t1.paymentMode = t7.id \
                left join currency t8 on t1.currency = t8.id \
                left join inward_return_reasons t9 on t1.chequeDDReturnReason = t9.id \
                left join languages t11 on t1.language = t11.id \
                left join payment t12 on t1.id=t12.inwardID \
                left join inward_agent_details t13 on t1.id=t13.inwardId \
                left join agents t14 on t13.agentId = t14.id \
                where t1.inwardNumber = ?

update_inward = update inward set \
                    inward.from = ?, country = (select id from countries where country = ?), state = (select id from states where state = ?), \
                    district = (select id from districts where district=?),city = (select id from cities where city=?) , pincode = ? , email = ?, institution = ? ,department = ?, \
                    subscriberId = (select id from subscriber where subscriberNumber=?), inwardPurpose = (select id from inward_purpose where purpose=?), \
                    paymentMode = (select id from payment_mode where payment_mode=?), bankName = ?, chqddNumber = ?, \
                    paymentDate = ?, amount = ?, currency = (select id from currency where currency=?), \
                    chequeDDReturn = ?, chequeDDReturnReason = (select id from inward_return_reasons where return_reason=?), \
                    chequeDDReturnReasonOther = ?, receiptNumber = ?, ackDate = ?, remarks = ?, \
                    language = (select id from languages where language = ?) \
                    where inwardNumber = ?

update_payment_info = update payment set subscriptionID=? where inwardID=(select id from inward where inwardNumber=?)

update_urn_info = update inward set chqDDNumber=?,amount=?, paymentDate=? where inwardNumber=?

# The where/and clause is formed dynamically in the searchInward in IAS.Model.inward.java
search_inwards = SELECT t1.id AS inwardID, \
                        inwardNumber, \
                        t4.subscriberNumber AS subscriberId, \
                        t1.from, \
                        DATE_FORMAT(inwardCreationDate, '%d/%m/%Y') AS inwardCreationDate, \
                        t2.city AS city, \
                        chqddNumber, \
                        t3.purpose AS inwardPurpose, \
                        t1.inwardPurpose AS inwardPurposeID, \
                        t1.amount, \
                        t1.completed \
                   FROM inward t1 \
                        LEFT JOIN cities t2 \
                           ON t1.city = t2.id \
                        LEFT JOIN inward_purpose t3 \
                           ON t1.inwardPurpose = t3.id \
                        LEFT JOIN subscriber t4 \
                           ON t1.subscriberId = t4.id \
                  WHERE inwardNumber IS NOT NULL

search_subscriber_inward = SELECT t1.id, \
                                inwardNumber, \
                                DATE_FORMAT(inwardCreationDate, '%d/%m/%Y') AS inwardCreationDate, \
                                t1.amount, \
                                t3.purpose AS inwardPurpose, \
                                t5.currency, \
                                DATE_FORMAT(ackDate, '%d/%m/%Y') AS ackDate, \
                                t1.completed, \
                                t1.chequeDDReturn, \
                                t1.chqddNumber, \
                                DATE_FORMAT(t1.paymentDate, '%d/%m/%Y') AS chqDate, \
                                t1.receiptNumber, \
                                t1.receiptDate \
                           FROM inward t1 \
                                LEFT JOIN inward_purpose t3 \
                                   ON t1.inwardPurpose = t3.id \
                                LEFT JOIN subscriber t4 \
                                   ON t1.subscriberID = t4.id \
                                LEFT JOIN currency t5 \
                                   ON t1.currency = t5.id \
                          WHERE t4.subscriberNumber = ? \
                         ORDER BY t1.id DESC


search_inward_count = select count(*) from inward t1 \
                left join cities t2 on t1.city = t2.id \
                left join inward_purpose t3 on t1.inwardPurpose = t3.id \
                left join subscriber t4 on t1.subscriberId = t4.id \
                where inwardNumber is not NULL

pending_inwards = SELECT inwardNumber, \
                        t4.subscriberNumber AS subscriberId, \
                        t14.agentName, \
                        t1.from, \
                        t1.amount, \
                        DATE_FORMAT(inwardCreationDate, '%d/%m/%Y') AS inwardCreationDate, \
                        t2.city AS city, \
                        LPAD(chqddNumber, 6, '0') as chqddNumber, \
                        t3.purpose AS inwardPurpose, \
                        t1.inwardPurpose AS inwardPurposeID, \
                        t1.inwardCreationDate AS sortdate \
                   FROM inward t1 \
                        LEFT JOIN cities t2 \
                           ON t1.city = t2.id \
                        LEFT JOIN inward_purpose t3 \
                           ON t1.inwardPurpose = t3.id \
                        LEFT JOIN subscriber t4 \
                           ON t1.subscriberId = t4.id \
                        LEFT JOIN inward_agent_details t13 \
                           ON t1.id = t13.inwardId \
                        LEFT JOIN agents t14 \
                           ON t13.agentId = t14.id \
                  WHERE t1.completed = FALSE

update_cheque_return =  update inward set \
                        chequeDDReturn = ?, chequeDDReturnReason = (select id from inward_return_reasons where return_reason=?), \
                        chequeDDReturnReasonOther = ? , returnDate = ? where inwardNumber = ?

update_cheque_return_details = INSERT INTO chq_return_details \
                                SET return_reason_id = \
                                       (SELECT id \
                                          FROM inward_return_reasons \
                                         WHERE return_reason = ?), \
                                    return_reason_other = ?, \
                                    return_date = ?, \
                                    amount = ?, \
                                    inward_id = ?, \
                                    chq_no = ?, \
                                    chq_date = ? \
                                ON DUPLICATE KEY UPDATE return_reason_id = values(return_reason_id), \
                                                        return_reason_other = values(return_reason_other), \
                                                        return_date = values(return_date), \
                                                        amount = values(amount)

print_email_chq_return = SELECT t3.subscriberNumber as subscriberId, \
                                t2.inwardNumber, \
                                t1.chq_no as chqddNumber, \
                                DATE_FORMAT(t1.chq_date, '%d/%m/%Y') as paymentDate, \
                                t4.return_reason as chequeDDReturnReason, \
                                t1.return_reason_other as chequeDDReturnReasonOther, \
                                t1.amount, \
                                t2.email, \
                                t3.email as subscriberEmail \
                           FROM chq_return_details t1, inward t2, subscriber t3, inward_return_reasons t4 \
                          WHERE     t1.inward_id = t2.id \
                                AND t2.subscriberId = t3.id \
                                AND t1.return_reason_id = t4.id \
                                AND t2.inwardNumber = ? \
                                AND t1.chq_no = ?

update_subscriber_in_inward = update inward set subscriberId = ? where inwardNumber = ?

update_inward_complete_flag = update inward set completed = true where id = ?

insert_in_agent_dtls = insert into inward_agent_details ( inwardId , agentId ) values (? , (select id from agents where agentName = ?))

update_in_agent_dtls = update inward_agent_details set agentId = (select id from agents where agentName = ?) where inwardId = ?

get_in_agent_dtls = select agentName from agents where id = (select agentId from inward_agent_details where inwardId = ? )


#--------------------------------------------------------------------------
# Subscriber
#--------------------------------------------------------------------------

get_subscriber_id_from_number = select id from subscriber where subscriberNumber = ?

subscriber_insert = insert into subscriber(subscriberNumber, subscriberCreationDate, subscriberName, shippingAddress, invoiceAddress,city, district, state, country, pincode, subtype, \
                    department, institution, email, agent, deactive) \
                     values (?,?,?,?,?, \
                    (select id from cities where city=?), \
                    (select id from districts where district=?), \
                    (select id from states where state=?), \
                    (select id from countries where country=?),?, \
                    (select id from subscriber_type where subtype=? and subtypedesc=?),?,?,?, \
                    (select id from agents where agentName = ?),?)

get_last_subscriber = SELECT subscriberNumber FROM subscriber where YEAR(subscriberCreationDate)=YEAR(CURDATE()) ORDER BY id DESC LIMIT 1
#SELECT subscriberNumber,subscriberCreationDate FROM subscriber ORDER BY id DESC LIMIT 1


get_subscriber_by_number = select t1.id as subscriberID \
                      ,t1.subscriberNumber\
                      ,t1.subscriberName \
                      ,t1.subtype as subtypeID \
                      ,DATE_FORMAT(t1.subscriberCreationDate,'%d/%m/%Y') as subscriberCreationDate \
                      ,t1.shippingAddress \
                      ,t1.invoiceAddress \
                      ,t2.city \
                      ,t3.district \
                      ,t4.state \
                      ,t5.country \
                      ,t1.pincode \
                      ,t6.subtype \
                      ,t6.subtypedesc \
                      ,t1.department \
                      ,t1.institution \
                      ,t1.email \
                      ,t7.agentName \
                      ,t1.deactive \
                      ,DATE_FORMAT(t1.deactivationDate,'%d/%m/%Y') as deactivationDate \
                      ,t6.subtypecode \
                from subscriber t1 \
                left join cities t2 on t1.city = t2.id \
                left join districts t3 on t1.district = t3.id \
                left join states t4 on t1.state = t4.id \
                left join countries t5 on t1.country = t5.id \
                left join subscriber_type t6 on t1.subtype = t6.id \
                left join agents t7 on t1.agent = t7.id \
                where t1.subscriberNumber = ?

update_subscriber = update subscriber set \
                subscriberName = ? \
               ,shippingAddress = ? \
               ,invoiceAddress = ? \
               ,city = (select id from cities where city = ?) \
               ,district = (select id from districts where district = ?) \
               ,state = (select id from states where state = ?) \
               ,country = (select id from countries where country = ?) \
               ,pincode = ? \
               ,subtype = (select id from subscriber_type where subtype=? and subtypedesc=?) \
               ,department = ? \
               ,institution = ? \
               ,email = ? \
               ,agent = (select id from agents where agent = ?) \
               ,deactive = ? \
                where subscriberNumber = ?

search_subscriber = select t1.id as subscriberID,subscriberNumber, subscriberName, department, institution, t3.country, t4.state, \
                t2.city as city, pincode, email, t5.district \
                from subscriber t1 \
                left join cities t2 on t1.city = t2.id \
                left join countries t3 on t1.country = t3.id \
                left join states t4 on t1.state=t4.id \
                left join districts t5 on t1.district = t5.id

get_missing_issues_for_subscriber = SELECT t1.ID as id,\
                                        t3.INWARDNUMBER as inwardNumber,\
                                        t4.JOURNALNAME as journalName,\
                                        t2.volumeNo, \
                                        t2.issue, \
                                        t2.`year`,\
                                        t2.MISSINGCOPIES as missingcopies,\
                                        t2.ACTION as action,\
                                        t2.SENTON as senton \
                                   FROM missing_issue t1,\
                                        missing_issue_journals t2,\
                                        inward t3,\
                                        journals t4 \
                                WHERE     t1.SUBSCRIBERID = ? \
                                      AND t1.ID = t2.MISSINGISSUEID \
                                      AND t3.ID = t1.INWARDID \
                                      AND t2.JOURNALID = t4.ID \
                                      ORDER BY t1.ID DESC

get_chq_return_for_subscriber = SELECT  t1.id, \
                                        t1.chq_no AS chqNumber, \
                                        DATE_FORMAT(t1.chq_date, '%d/%m/%Y') AS chqDate, \
                                        t1.amount, \
                                        t4.return_reason AS returnReason, \
                                        DATE_FORMAT(t1.return_date, '%d/%m/%Y') AS returnDate \
                                   FROM chq_return_details t1, \
                                        inward t2, \
                                        subscriber t3, \
                                        inward_return_reasons t4 \
                                  WHERE     t1.inward_id = t2.id \
                                        AND t1.return_reason_id = t4.id \
                                        AND t2.subscriberId = t3.id \
                                        AND t3.subscriberNumber = ? \
                                  ORDER BY id

get_next_subscriber_number = select subscriberNumber from subscriber where id = (select id from subscriber where id > ? limit 1)
get_first_subscriber_number = select subscriberNumber from subscriber where id = (select id from subscriber order by id asc limit 1)


#--------------------------------------------------------------------------
# Subscription
#--------------------------------------------------------------------------
get_subscription_for_subscriber =   SELECT t10.id, \
                                        t10.inwardNumber, \
                                        t10.inwardID, \
                                        t10.subscriptionDate, \
                                        t10.subscriptionTotal, \
                                        t10.legacy, \
                                        t10.currency, \
                                        (  subscriptionTotal \
                                         - (COALESCE(t10.amount, 0) + sum(COALESCE(t12.amount, 0)))) \
                                           AS balance, \
                                        COALESCE(t10.legacy_balance, 0) as legacy_balance, \
                                        t14.agentName, \
                                        t10.chqddNumber, \
                                        t10.amount AS inwardAmount, \
                                        sum(COALESCE(t12.amount, 0)) AS payment, \
                                        (t10.amount + sum(COALESCE(t12.amount, 0))) AS amountPaid, \
                                        t10.receiptNumber, \
                                        t10.receiptDate \
                                   FROM          (SELECT t4.id, \
                                                         t5.id AS inwardID, \
                                                         t5.inwardNumber, \
                                                         t4.subscriptionDate, \
                                                         t4.subscriptionTotal, \
                                                         t4.legacy, \
                                                         t4.legacy_balance, \
                                                         t6.currency, \
                                                         t5.chqddNumber, \
                                                         t5.amount, \
                                                         t5.receiptNumber, \
                                                         DATE_FORMAT(t5.receiptDate, '%d/%m/%Y') \
                                                            AS receiptDate \
                                                    FROM (SELECT t20.id, \
                                                                 t20.subscriptionDate, \
                                                                 t20.subscriptionTotal, \
                                                                 t20.inwardID, \
                                                                 COALESCE(t21.legacy, 0) AS legacy, \
                                                                 t21.legacy_balance \
                                                            FROM    (SELECT t1.id, \
                                                                            DATE_FORMAT(t1.subscriptionDate, '%d/%m/%Y') AS subscriptionDate, \
                                                                            COALESCE(sum(t2.copies * t5.rate), 0) AS subscriptionTotal, \
                                                                            t1.inwardID \
                                                                       FROM (subscription t1, \
                                                                            subscriptiondetails t2, \
                                                                            subscriber t3) left join subscription_rates t5 on t2.journalPriceGroupID = t5.id \
                                                                      WHERE t3.subscriberNumber = ? \
                                                                            AND t1.id = t2.subscriptionID \
                                                                            AND t1.subscriberID = t3.id \
                                                                     GROUP BY t1.id) t20 \
                                                                 LEFT JOIN \
                                                                    subscription_legacy t21 \
                                                                 ON t20.id = t21.subscription_id) t4 \
                                                         LEFT JOIN inward t5 \
                                                            ON t4.inwardID = t5.id \
                                                         LEFT JOIN currency t6 \
                                                            ON t5.currency = t6.id) t10 \
                                              LEFT JOIN \
                                                 invoice t11 \
                                              ON t10.id = t11.subscriptionId \
                                           LEFT JOIN \
                                              payment t12 \
                                           ON t11.id = t12.invoice_id \
                                        LEFT JOIN \
                                           (inward_agent_details t13, agents t14) \
                                        ON t10.inwardID = t13.inwardId AND t13.agentID = t14.id \
                                 GROUP BY t10.id \
                                 ORDER BY t10.id DESC

get_subscription_info_by_id =   SELECT t6.ID, \
                                        t6.INWARDNUMBER AS inwardNumber, \
                                        t6.AMOUNT AS amount, \
                                        COALESCE(t9.SUBSCRIPTIONTOTAL, 0) AS subscriptionTotal, \
                                        (COALESCE(t9.SUBSCRIPTIONTOTAL, 0) - t6.AMOUNT) AS balance, \
                                        t11.agentName \
                                   FROM       (SELECT t1.ID, \
                                                      t1.INWARDID, \
                                                      t2.INWARDNUMBER, \
                                                      (sum(COALESCE(t13.AMOUNT, 0)) + COALESCE(t2.AMOUNT, 0)) \
                                                         AS amount \
                                                 FROM subscription t1 \
                                                      LEFT JOIN inward t2 \
                                                         ON t1.inwardID = t2.id \
                                                      LEFT JOIN invoice t12 \
                                                         ON t1.id = t12.subscriptionId \
                                                      LEFT JOIN payment t13 \
                                                         ON t12.id = t13.invoice_id \
                                                WHERE t1.ID = ? \
                                               GROUP BY t1.ID) t6 \
                                           LEFT JOIN \
                                              (SELECT t7.SUBSCRIPTIONID, \
                                                      sum(t7.COPIES * t8.RATE) AS subscriptiontotal \
                                                 FROM subscriptiondetails t7, subscription_rates t8 \
                                                WHERE t7.JOURNALPRICEGROUPID = t8.ID AND t7.ACTIVE = TRUE \
                                               GROUP BY t7.SUBSCRIPTIONID) t9 \
                                           ON t6.ID = t9.SUBSCRIPTIONID \
                                        LEFT JOIN \
                                           (inward_agent_details t10, agents t11) \
                                        ON t6.INWARDID = t10.INWARDID AND t10.agentID = t11.id

get_subscription_detail_by_subscription_id =    select t2.id \
                                , t3.journalGroupName as journalGroupName \
                                , t2.journalGroupID \
                                , t2.startYear \
                                , t2.startMonth \
                                , t2.endYear \
                                , t2.copies \
                                , (t2.copies * t4.rate) as total \
                                , (select rate from subscription_rates where id=t2.journalPriceGroupID) as journalGroupCost\
                                , t2.active \
                            from subscription t1 \
                                , subscriptiondetails t2 \
                                , journal_groups t3 \
                                , subscription_rates t4 \
                            where t1.id = t2.subscriptionID \
                                and t2.journalGroupID = t3.id \
                                and t2.journalPriceGroupID = t4.id \
                                and t1.id = ? \
                                order by t2.id asc

get_subscription_detail_by_subscription_id_free = SELECT \
                                                    t2.id, \
                                                    t3.journalGroupName AS journalGroupName, \
                                                    t2.journalGroupID, \
                                                    t2.startYear, \
                                                    t2.startMonth, \
                                                    t2.endYear, \
                                                    t2.copies, \
                                                    0 AS total, \
                                                    0 AS journalGroupCost, \
                                                    t2.active \
                                                  FROM \
                                                    subscription t1, \
                                                    subscriptiondetails t2, \
                                                    journal_groups t3 \
                                                  WHERE \
                                                    t1.id = t2.subscriptionID AND \
                                                    t2.journalGroupID = t3.id AND \
                                                    t1.id = ? \
                                                  ORDER BY \
                                                    t2.id ASC

#insert_subscription = insert into subscription(subscriberID,inwardID,balance,subscriptionDate,subscriptionTotal,remarks) \
#                     values ((select id from subscriber where subscriberNumber=?),(select id from inward where inwardNumber=?),?,?,?,?)

insert_subscription = insert into subscription(subscriberID,inwardID,subscriptionDate) \
                      values ((select id from subscriber where subscriberNumber=?), \
                                (select id from inward where inwardNumber=?),?)

insert_subscription_detail = insert into subscriptiondetails ( \
                            subscriptionID,journalGroupID,journalPriceGroupID,copies,startYear,startMonth,endMonth, endYear) \
                            values (?, ?, ?, ?, ?, ?, ?, ?)


delete_subscription = update subscription set active = false where id=?


get_subscription_details =  SELECT \
                                t1.id, \
                                t2.journalGroupName,  \
                                t1.copies, \
                                t1.startYear, \
                                t1.endYear, \
                                (t1.copies * t3.rate) AS total, \
                                t1.active, \
                                t1.journalPriceGroupID, \
                                t3.period, \
                                t3.rate, \
                                MONTHNAME(STR_TO_DATE(t1.startMonth, '%m')) as startMonth, \
                                t1.journalGroupID \
                              FROM \
                                subscriptiondetails t1, \
                                journal_groups t2, \
                                subscription_rates t3 \
                              WHERE \
                                t1.journalGroupID = t2.id AND \
                                t1.journalPriceGroupID = t3.id AND \
                                t1.subscriptionID = ?

get_subscription_details_prl =  SELECT \
                                t1.id, \
                                t2.journalGroupName,  \
                                t1.copies, \
                                t1.startYear, \
                                t1.endYear, \
                                (t1.copies * t3.rate) AS total, \
                                t1.active, \
                                t1.journalPriceGroupID, \
                                t3.period, \
                                t3.rate, \
                                t1.startMonth, \
                                t1.journalGroupID, \
                                t5.subtype \
                              FROM \
                                subscriptiondetails t1, \
                                journal_groups t2, \
                                subscription_rates t3, \
                                subscription t4, \
                                subscriber t5 \
                              WHERE \
                                t1.journalGroupID = t2.id AND \
                                t1.journalPriceGroupID = t3.id AND \
                                t1.subscriptionID = t4.id AND \
                                t4.subscriberID = t5.id AND \
                                t1.subscriptionID = ? AND \
                                t1.endYear = ?

get_subscription_for_prl_invoice = SELECT t6.journalGroupName, t1.period, t5.rate \
                                    FROM prl_details t1, \
                                         invoice t2, \
                                         subscription t3, \
                                         subscriptiondetails t4, \
                                         subscription_rates t5, \
                                         journal_groups t6, \
                                         subscriber t7 \
                                   WHERE     t1.invoice_id = t2.id \
                                         AND t2.subscriptionId = t3.id \
                                         AND t3.id = t4.subscriptionID \
                                         AND t4.journalGroupID = t6.id \
                                         AND t3.subscriberID = t7.id \
                                         AND t5.journalGroupId = t4.journalGroupID \
                                         AND t5.subtypeId = t7.subtype \
                                         AND t5.period = t1.period \
                                         AND t5.`year` = ? \
                                         AND t3.id = ?

get_subscription_details_free_subscribers = SELECT \
                                                t3.journalGroupName, \
                                                t2.startYear, \
                                                t2.endYear, \
                                                MONTHNAME(STR_TO_DATE(t2.startMonth, '%m')) as startMonth, \
                                                t2.copies, \
                                                0 as total, \
                                                t1.active \
                                              FROM \
                                                subscription t1, \
                                                subscriptiondetails t2, \
                                                journal_groups t3, \
                                                subscriber t4, \
                                                subscriber_type t5 \
                                              WHERE \
                                                t1.subscriberID = t4.id AND \
                                                t4.subtype = t5.id AND \
                                                t5.subtype = 'Free' AND \
                                                t1.id = t2.subscriptionID AND \
                                                t2.journalGroupID = t3.id AND \
                                                t1.id = ?

get_journal_group_price = select id, rate from subscription_rates where journalGroupId = ? and subtypeid = ? \
                            and year = ? and period = ?

get_journal_groupid_contents = select t1.journalname from journals t1,journal_group_contents t2 \
                                where t2.journalId = t1.id and t2.journalGroupId = ?;

get_subscription_details_for_inward = SELECT t1.id AS subscriptionid, \
                                            t4.journalName, \
                                            t2.startYear, \
                                            t2.endYear, \
                                            t2.copies, \
                                            t2.startMonth, \
                                            t6.period, \
                                            t6.rate, \
                                            t2.journalGroupID, \
                                            (t2.copies * t6.rate) as total \
                                       FROM subscription t1, \
                                            subscriptiondetails t2, \
                                            journal_group_contents t3, \
                                            journals t4, \
                                            inward t5, \
                                            subscription_rates t6 \
                                      WHERE     t1.active = TRUE \
                                            AND t1.id = t2.subscriptionID \
                                            AND t2.journalGroupID = t3.journalGroupID \
                                            AND t3.journalID = t4.id \
                                            AND t1.inwardID = t5.id \
                                            AND t2.journalPriceGroupID = t6.id \
                                            AND t5.inwardNumber = ? \
                                     GROUP BY subscriptionid, \
                                              t2.journalGroupID, \
                                              t4.journalName, \
                                              t2.startYear, \
                                              t2.endYear

update_subscription_detail =    update subscriptiondetails set startYear=?, startMonth=?, endYear=?, \
                                journalPriceGroupID=? , copies=?, active=? \
                                where id=?;

update_subscription_balance = update subscription set subscriptionTotal=?, balance=? where id = ?

get_active_subscription_total_amount = select t1.subscriptionTotal,t2.amount from subscription t1, inward t2 where \
                                       t1.inwardID = t2.id and t1.id=?

get_subscription_inward_amount =    SELECT t3.INWARDNUMBER as inwardNumber, sum(t3.AMOUNT + COALESCE(t5.amount, 0)) as amount \
                                    FROM    (SELECT t2.INWARDNUMBER, t1.ID, t2.AMOUNT \
                                               FROM subscription t1, inward t2 \
                                              WHERE t1.INWARDID = t2.ID AND t1.id = ?) t3 \
                                         LEFT JOIN \
                                            (payment t4, inward t5) \
                                         ON t3.id = t4.SUBSCRIPTIONID AND t4.inwardID = t5.id
#--------------------------------------------------------------------------
# Reports
#--------------------------------------------------------------------------

!List Subscriber Type ---------------------------------------------

search_subtype_all = select id, subtypecode, subtypedesc, subtype, nationality, institutional, freejrnl, discount from subscriber_type order by id

search_subtype_prm = select id, subtypecode, subtypedesc, subtype, nationality, institutional, freejrnl, discount from subscriber_type where
!End List Subscriber Type ---------------------------------------------

!List Inward ---------------------------------------------
search_inward = select inwardNumber, t4.subscriberNumber as subscriberId, t1.from, DATE_FORMAT(inwardCreationDate,'%d/%m/%Y') as inwardCreationDate, t2.city as city, chqddNumber, t3.purpose as inwardPurpose, \
                t1.inwardPurpose as inwardPurposeID from inward t1 \
                left join cities t2 on t1.city = t2.id \
                left join inward_purpose t3 on t1.inwardPurpose = t3.id \
                left join subscriber t4 on t1.subscriberId = t4.id \
                left join currency t5 on t1.currency = t5.id \
                left join payment_mode t6 on t1.paymentMode = t6.id \
                left join countries t7 on t1.country = t7.id \
                left join states t8 on t1.state = t8.id \
                where inwardNumber is not NULL

!End List Inward ---------------------------------------------

!List Journal ---------------------------------------------

!list_journal_all = select id, journalCode, journalName, issnNo, pages, startYear, issues from journals

list_journal_group = select  t1.id, t1.journalCode, t1.journalName, t1.issnNo, t1.startYear \
                     from journals t1, journal_groups t2, journal_group_contents t3 where t1.id = \
                      t3.journalid and t2.id = t3.journalGroupId and
!End List Journals ---------------------------------------------

!List Agents ---------------------------------------------

list_agent_all = select t1.id\
                    ,t1.agentName \
                    ,t1.regDate \
                    ,t1.emailId \
                    ,t1.address \
                    ,t2.city \
                    ,t3.district \
                    ,t4.state \
                    ,t5.country \
                    ,t1.pinCode \
                    ,t1.discount \
                    from agents t1 \
                    left join cities t2 on t1.cityId = t2.id \
                    left join districts t3 on t1.districtId = t3.id \
                    left join states t4 on t1.stateId = t4.id \
                    left join countries t5 on t1.countryId = t5.id

list_agent_prm = select t1.id\
                    ,t1.agentName \
                    ,t1.regDate \
                    ,t1.emailId \
                    ,t1.address \
                    ,t2.city \
                    ,t3.district \
                    ,t4.state \
                    ,t5.country \
                    ,t1.pinCode \
                    ,t1.discount \
                    from agents t1 \
                    left join cities t2 on t1.cityId = t2.id \
                    left join districts t3 on t1.districtId = t3.id \
                    left join states t4 on t1.stateId = t4.id \
                    left join countries t5 on t1.countryId = t5.id \
                    where
!End List Agents ---------------------------------------------

!Circulation Figures ---------------------------------------------

list_circulation_figures = select journalCode, journalName, instIndia, instAbroad, indiAbroad, indiIndia, \
                            comp, totalCopies, auth, printOrder, balanceCopies from circulation_figure
!End Cisrculation Figures ---------------------------------------------

!statement ---------------------------------------------

journal_id = select id from journals where journalName = ?

subscriber_type = select subtypecode from subscriber_type

statement = select subtypecode, count(subscriberId), sum(copies) \
            FROM mailing_list_detail \
            where journalId = ? and issue = ? and `year` = ? and subtypecode = ? \
            and volumeNumber = ? group by subtypecode

!End statement ---------------------------------------------

!Circulation Figures ---------------------------------------------

cf_journals = SELECT id, journalCode from journals

cf_issue_volumeno = select issue, volumeNumber from mailing_list where `year` = ?  and journalId = ? and month = (select months.Id from months where months.month = ?)

cf_print_order = select printOrder from print_order where `year` = ? and journalId = ? and issueNo = ?

cf_inst_i = select sum(mailing_list_detail.copies) as inst_i \
                from mailing_list_detail left join subscriber_type on mailing_list_detail.subtypecode = subscriber_type.subtypecode \
                where subscriber_type.nationality = 'I' AND subscriber_type.institutional = 'I' \
                and mailing_list_detail.`year` = ? and subscriber_type.subtype = 'PAID' \
                and mailing_list_detail.journalId = ? and mailing_list_detail.issue = ? \
                and mailing_list_detail.volumeNumber = ? \
                group by \
                mailing_list_detail.journalId, mailing_list_detail.`year`, mailing_list_detail.issue, subscriber_type.institutional, subscriber_type.nationality

cf_inst_f = select sum(mailing_list_detail.copies) as inst_f \
            from mailing_list_detail left join subscriber_type on mailing_list_detail.subtypecode = subscriber_type.subtypecode \
            where subscriber_type.nationality = 'F' AND subscriber_type.institutional = 'I' \
            and mailing_list_detail.`year` = ? and subscriber_type.subtype = 'PAID' \
            and mailing_list_detail.journalId = ? and mailing_list_detail.issue = ? \
            and mailing_list_detail.volumeNumber = ? \
            group by \
            mailing_list_detail.journalId, mailing_list_detail.`year`, mailing_list_detail.issue, subscriber_type.institutional, subscriber_type.nationality

cf_ind_i =  select sum(mailing_list_detail.copies) as ind_i \
            from mailing_list_detail left join subscriber_type on mailing_list_detail.subtypecode = subscriber_type.subtypecode \
            where subscriber_type.nationality = 'I' AND subscriber_type.institutional = 'P' \
            and mailing_list_detail.`year` = ? and subscriber_type.subtype = 'PAID' \
            and mailing_list_detail.journalId = ? and mailing_list_detail.issue = ? \
            and mailing_list_detail.volumeNumber = ? \
            group by \
            mailing_list_detail.journalId, mailing_list_detail.`year`, mailing_list_detail.issue, subscriber_type.institutional, subscriber_type.nationality

cf_ind_f = select sum(mailing_list_detail.copies) as ind_f \
            from mailing_list_detail left join subscriber_type on mailing_list_detail.subtypecode = subscriber_type.subtypecode \
            where subscriber_type.nationality = 'F' AND subscriber_type.institutional = 'P' \
            and mailing_list_detail.`year` = ? and subscriber_type.subtype = 'PAID' \
            and mailing_list_detail.journalId = ? and mailing_list_detail.issue = ? \
            and mailing_list_detail.volumeNumber = ? \
            group by \
            mailing_list_detail.journalId, mailing_list_detail.`year`, subscriber_type.institutional, subscriber_type.nationality, mailing_list_detail.issue

cf_free = select sum(mailing_list_detail.copies) as comp \
            from mailing_list_detail left join subscriber_type on mailing_list_detail.subtypecode = subscriber_type.subtypecode \
            where subscriber_type.subtype = 'FREE' and subscriber_type.subtypecode <> 'AUTH'\
            and mailing_list_detail.`year` = ? \
            and mailing_list_detail.journalId = ? and mailing_list_detail.issue = ? \
            and mailing_list_detail.volumeNumber = ? \
            group by \
            mailing_list_detail.journalId, mailing_list_detail.`year`, mailing_list_detail.issue

cf_auth = select sum(mailing_list_detail.copies) as auth \
            from mailing_list_detail left join subscriber_type on mailing_list_detail.subtypecode = subscriber_type.subtypecode \
            where subscriber_type.subtypecode = 'AUTH' \
            and mailing_list_detail.`year` = ? \
            and mailing_list_detail.journalId = ?  and mailing_list_detail.issue = ? \
            and mailing_list_detail.volumeNumber = ? \
            group by \
            mailing_list_detail.journalId, mailing_list_detail.`year`, mailing_list_detail.issue

!End Cisrculation Figures ---------------------------------------------

! Subscription Rates
rep_sub_rate = select journalGroupName, subTypeDesc, `year`, year1, year2, year3, year5 from temp_sub_rate

!End Subscription Rates
! List ML
listml = select t1.id, t1.journalCode, t1.subtypecode, t1.subscriberNumber, t1.subscriberName, concat(t1.department , t1.institution, \
                t1.address) as address, t1.city, t1.district, t1.state, t1.country, t1.pincode, t1.copies, t1.issue, t1.month, t1.`year`, \
                concat(t1.startYear, "-", t1.startMonth) as start, concat(t1.endMonth, "-", t1.endYear) as end \
                FROM mailing_list_detail as t1, journals \
                where t1.journalId = journals.id and \
                journals.journalName = ? and t1.issue = ? AND  t1.`year` = ? AND t1.volumeNumber = ? AND t1.month = (select Id from months where months.month = ?)
! End List ML

! List BIL
listbil = select t1.journalCode, t1.subtypecode, t1.subscriberNumber, t1.subscriberName, t1.department , t1.institution, \
                t1.address, t1.city, t1.district, t1.state, t1.country, t1.pincode, t1.copies, t1.issue, t1.month, t1.`year`, \
                t1.startYear, t1.startMonth, t1.endYear, t1.endMonth \
                FROM mailing_list_detail as t1 left join subscriber_type on t1.subtypecode = subscriber_type.subtypecode \
                left join journals on t1.journalId = journals.id \
                where t1.bilid <> "" and \
                journals.journalName = ? and t1.issue = ? AND  t1.`year` = ?
! End List BIL

! Subscription Figures
subscription_Figures = SELECT count(subscriber.subscriberNumber), sum(subscriptiondetails.copies) \
                        FROM subscriptiondetails \
                             LEFT JOIN subscription \
                                ON subscriptiondetails.subscriptionID = subscription.id \
                             LEFT JOIN subscriber \
                                ON subscription.subscriberID = subscriber.id \
                             LEFT JOIN subscriber_type \
                                ON subscriber.subtype = subscriber_type.id \
                             LEFT JOIN journal_groups \
                                ON subscriptiondetails.journalGroupID = journal_groups.id \
                             RIGHT JOIN journal_group_contents \
                                ON journal_group_contents.journalGroupId = journal_groups.id \
                             LEFT JOIN journals \
                                ON journal_group_contents.journalId = journals.id \
                       WHERE journals.journalCode = ? \
                             AND subscriber_type.subtypecode = ?


! End Subscription figures
!get_max_no_of_issues = select max(issues) FROM journals
get_max_no_of_issues = select max(issues) FROM journal_details where journal_details.`year` = ?

get_list_of_journals = select journalCode FROM journals;

!get_no_of_issues = select issues from journals where journalCode = ?
get_no_of_issues = select issues from journal_details where journal_details.journals_id = (select id from journals where journals.journalCode = ?) and journal_details.`year`=?

get_print_order = select printOrder from print_order where `year`=? and journalId=(select id from journals where journals.journalCode=?) and issueNo=?

! List susbcriber
list_susbsriber = select distinct subscriber.subscriberNumber, subscriber.subscriberName, subscriber_type.subtypecode, \
                    subscriber.department, subscriber.institution, subscriber.pincode, \
                    cities.city, states.state, countries.country, districts.district, subscriber.shippingAddress as address \
                    from subscriber \
                    left join countries on subscriber.country = countries.id \
                    left join states on subscriber.state = states.id \
                    left join cities on subscriber.city = cities.id \
                    left join districts on subscriber.district = districts.id \
                    left join subscriber_type on subscriber.subtype = subscriber_type.id \
                    left join subscription on subscription.subscriberID = subscriber.id \
                    left join subscriptiondetails on subscriptiondetails.subscriptionID = subscription.id \
                    left join journal_groups on subscriptiondetails.journalGroupID = journal_groups.id \
                    left join journal_group_contents on journal_group_contents.journalGroupId = journal_groups.id \
                    left join journals on journal_group_contents.journalId = journals.id \
                    where subscription.active = 1

! End List subscriber

! List Profarma Invoice
list_invoice = select invoice.invoiceNumber, invoice.invoiceCreationDate, \
               subscriber.subscriberNumber, subscriber.subscriberName, \
                subscriber_type.subtypecode, journals.journalCode, subscriptiondetails.copies, subscriptiondetails.startYear, \
                subscriptiondetails.endYear \
                from invoice, subscription, subscriber, subscriber_type, subscriptiondetails, \
                journal_groups, journal_group_contents, journals \
                where invoice.subscriptionId = subscription.id and subscription.subscriberID = subscriber.id \
                and subscriber.subtype = subscriber_type.id and subscriptiondetails.subscriptionID = subscription.id \
                and subscriptiondetails.journalGroupID = journal_groups.id and journal_group_contents.journalGroupId = journal_groups.id \
                and journal_group_contents.journalId = journals.id
! End List Profarma Invoice

! List Journal Rates
journal_groups = select id, journalGroupName from journal_groups

get_rate_period = select distinct(period) from subscription_rates where `year` = ?

get_rate = select subscription_rates.rate as price_rate \
           from \
            subscription_rates, subscriber_type \
            where \
            subscription_rates.`year` = ? AND subscription_rates.period = ? \
            AND subscription_rates.journalGroupId = ? AND subscription_rates.subtypeId = subscriber_type.id \
            and subscriber_type.subtypedesc = ?

! End List Journal Rates

!List Reminders
list_reminders_subscriber =  select subscription.id as subId, subscriber_type.subtypecode, subscriber.subscriberNumber, \
                                subscriber.subscriberName, reminders.balance, reminders.reminderType, reminders.reminderDate, \
                                subscriber.email \
                                from reminders, subscription, \
                                subscriber, subscriber_type \
                                where \
                                subscription.subscriberID = subscriber.id and reminders.subscriptionId = subscription.id \
                                and subscriber.subtype = subscriber_type.id \
                                and reminders.reminderType = ?
! End List Reminders

! Ourstanding Balance Report --------------------
get_legacy_balance = select subscriber.subscriberNumber as subscriberNumber, subscription.id as subscriptionId, subscriber_type.subtypecode as subtypeCode, \
                        subscription_legacy.legacy_balance as balance, subscription_legacy.legacy_proforma_invoice_no as proInvNo, \
                        date_format(subscription_legacy.legacy_proforma_invoice_date, '%d/%M/%y') as proInvDate \
                        from subscription \
                        left join subscription_legacy on subscription_legacy.subscription_id = subscription.id \
                        left join subscriber on subscription.subscriberID = subscriber.id \
                        left join subscriber_type on subscriber.subtype = subscriber_type.id \
                        where subscription_legacy.legacy = 1 and subscription_legacy.legacy_balance <> 0


get_sub_journals = select journals.journalCode, \
                   subscriptiondetails.startYear as startYear, subscriptiondetails.endYear as endYear \
                    from \
                    subscriptiondetails left join journal_groups on subscriptiondetails.journalGroupID = journal_groups.id \
                    left join journal_group_contents on journal_group_contents.journalGroupId = journal_groups.id \
                    left join journals on journal_group_contents.journalId = journals.id \
                    where subscriptiondetails.subscriptionID = ?

get_current_balance = Select subscriber.subscriberNumber as subscriberNumber, subscription.id as subscriptionId, \
                      subscriber_type.subtypecode as subtypeCode, \
                     invoice.amount as amount, sum(payment.amount) as payment, invoice.invoiceNumber as proInvNo, date_format(invoice.invoiceCreationDate, '%d/%M/%y') as proInvDate \
                     from \
                     subscription left join subscriber on subscription.subscriberID = subscriber.id \
                     left join invoice on invoice.subscriptionId = subscription.id \
                     left join payment on payment.invoice_id = invoice.id \
                     left join subscriber_type on subscriber.subtype = subscriber_type.id \
                     where subscription.id not in ( select subscription_legacy.subscription_id from subscription_legacy) \
                    group by subscription.id, invoice.id, payment.id

! End Outstanding Balance Report
#--------------------------------------------------------------------------
# End Reports
#--------------------------------------------------------------------------

#--------------------------------------------------------------------------
# Invoice
#--------------------------------------------------------------------------
get_last_invoice = SELECT invoiceNumber, invoiceCreationDate FROM invoice where YEAR(invoiceCreationDate)=YEAR(CURDATE()) ORDER BY id DESC LIMIT 1

invoice_insert = INSERT INTO invoice(invoiceNumber, \
                    subscriptionID, \
                    invoiceCreationDate, \
                    invoice_type_id, \
                    amount) \
                VALUES (?, \
                        ?, \
                        ?, \
                        ?, \
                        ?)

get_invoice_detail = SELECT \
                        t1.id AS inwardID, \
                        t1.inwardNumber, \
                        t3.subscriberName, \
                        t3.subscriberNumber, \
                        t3.department, \
                        t3.institution, \
                        t3.email, \
                        t3.pincode, \
                        t7.city, \
                        t8.country, \
                        t2.id AS subscriptionID, \
                        t2.subscriberID, \
                        t3.shippingAddress, \
                        t3.invoiceAddress, \
                        t4.invoiceNumber, \
                        DATE_FORMAT( \
                          t4.invoiceCreationDate, \
                          '%d/%m/%Y') \
                          AS invoiceCreationDate, \
                        sum(t6.rate * t5.copies) AS subscriptionTotal, \
                        (sum(t6.rate * t5.copies) - t1.amount) as balance, \
                        t1.amount as inwardAmount, \
                        t4.amount, \
                        t1.email as inwardEmail \
                      FROM \
                        inward t1, \
                        subscription t2, \
                        subscriber t3, \
                        invoice t4, \
                        subscriptiondetails t5, \
                        subscription_rates t6, \
                        cities t7, \
                        countries t8 \
                      WHERE \
                        t1.inwardNumber = ? AND \
                        t2.inwardID = t1.id AND \
                        t3.id = t2.subscriberID AND \
                        t3.city = t7.id AND \
                        t3.country = t8.id AND \
                        t4.subscriptionID = t2.id AND \
                        t5.subscriptionID = t2.id AND \
                        t5.journalPriceGroupID = t6.id


search_subscriber_invoice = SELECT t5.invoiceID, \
                                    t5.invoiceNumber, \
                                    t5.invoiceAmount, \
                                    t5.invoice_type_id, \
                                    t5.invoice_type, \
                                    t5.invoiceCreationDate, \
                                    t5.subscriptionId AS subscriptionID, \
                                    COALESCE(sum(t6.amount), 0) as amountPaid, \
                                    (t5.invoiceAmount - COALESCE(sum(t6.amount), 0)) AS balance \
                               FROM    (SELECT t1.id AS invoiceID, \
                                               t1.invoiceNumber, \
                                               t1.amount AS invoiceAmount, \
                                               t1.invoice_type_id, \
                                               t2.invoice_type, \
                                               DATE_FORMAT(t1.invoiceCreationDate, '%d/%m/%Y') \
                                                  AS invoiceCreationDate, \
                                               t1.subscriptionId \
                                          FROM invoice t1, \
                                               invoice_types t2, \
                                               subscriber t3, \
                                               subscription t4 \
                                         WHERE     t1.subscriptionId = t4.id \
                                               AND t4.subscriberID = t3.id \
                                               AND t1.invoice_type_id = t2.id \
                                               AND t3.subscriberNumber = ? \
                                        GROUP BY t1.id \
                                        ORDER BY t1.id DESC) t5 \
                                    LEFT JOIN \
                                       payment t6 \
                                    ON t5.invoiceID = t6.invoice_id \
                                    GROUP BY t5.invoiceID \
                                    ORDER BY t5.invoiceID DESC \


get_invoice_detail_usng_invno =  SELECT t9.id, \
                                    t9.invoiceCreationDate, \
                                    t9.subscriptionID, \
                                    t9.inwardNumber, \
                                    t9.shippingAddress, \
                                    t9.invoiceAddress, \
                                    t9.subscriberName, \
                                    t9.subscriberNumber, \
                                    t9.email, \
                                    t9.invoiceNumber, \
                                    t9.department, \
                                    t9.institution, \
                                    t9.pincode, \
                                    t9.city, \
                                    t9.country, \
                                    t9.subscriptionTotal, \
                                    t9.invoiceTypeID, \
                                    t9.inwardAmount, \
                                    t9.amount, \
                                    sum(COALESCE(t10.amount, 0)) AS amountPaid, \
                                    (t9.amount - sum(COALESCE(t10.amount, 0))) AS balance \
                               FROM    (SELECT t5.id, \
                                               DATE_FORMAT(t5.invoiceCreationDate, '%d/%m/%Y') \
                                                  AS invoiceCreationDate, \
                                               t2.id AS subscriptionID, \
                                               t6.inwardNumber, \
                                               t1.shippingAddress, \
                                               t1.invoiceAddress, \
                                               t1.subscriberName, \
                                               t1.subscriberNumber, \
                                               t1.email, \
                                               t5.invoiceNumber, \
                                               t1.department, \
                                               t1.institution, \
                                               t1.pincode, \
                                               t7.city, \
                                               t8.country, \
                                               sum(t3.copies * t4.rate) AS subscriptionTotal, \
                                               t5.invoice_type_id AS invoiceTypeID, \
                                               t6.amount AS inwardAmount, \
                                               t5.amount \
                                          FROM subscriber t1, \
                                               subscription t2, \
                                               subscriptiondetails t3, \
                                               subscription_rates t4, \
                                               invoice t5, \
                                               inward t6, \
                                               cities t7, \
                                               countries t8 \
                                         WHERE     t1.id = t2.subscriberID \
                                               AND t3.subscriptionID = t2.id \
                                               AND t3.journalPriceGroupID = t4.id \
                                               AND t2.id = t5.subscriptionId \
                                               AND t6.id = t2.inwardID \
                                               AND t1.city = t7.id \
                                               AND t1.country = t8.id \
                                               AND t5.invoiceNumber = ?) t9 \
                                    LEFT JOIN \
                                       payment t10 \
                                    ON t9.id = t10.invoice_id \

get_invoice_detail_for_prl = SELECT \
                                t6.id as subscriberId, \
                                t6.subscriberNumber, \
                                t1.subscriptionId, \
                                t6.subscriberName, \
                                t6.invoiceAddress, \
                                t6.shippingAddress, \
                                t6.subtype as subscriberType, \
                                t6.email, \
                                t1.amount \
                              FROM \
                                invoice t1, \
                                subscription t2, \
                                subscriptiondetails t3, \
                                journals t4, \
                                journal_group_contents t5, \
                                subscriber t6 \
                              WHERE \
                                t1.subscriptionId = t2.id AND \
                                t2.id = t3.subscriptionID AND \
                                t3.journalGroupID = t5.journalGroupId AND \
                                t5.journalId = t4.id AND \
                                t2.subscriberID = t6.id AND \
                                t1.invoice_type_id = 3 AND \
                                t1.invoiceNumber = ? \
                              GROUP BY \
                                t6.subscriberNumber

#--------------------------------------------------------------------------
# Start Mailing List
#--------------------------------------------------------------------------

getvolumes = select  journal_volume_details.volume_number as volumeNumber from journal_details, journals, journal_volume_details \
            where journal_volume_details.journal_details_id = journal_details.id and journal_details.journals_id = journals.id \
            and journals.journalName = ? and journal_details.`year` = ?

getissues = Select issueNumber from issues where issues.issueNumber <= \
            (select issues from journals, journal_details, journal_volume_details \
            where  journal_volume_details.journal_details_id = journal_details.id \
            and journal_details.journals_id = journals.id \
            and journalName = ? and journal_volume_details.volume_number = ?)



select_generateml =   SELECT subscriber.id,\
                                subscription.id,\
                                subscriptiondetails.id,\
                                journals.id,\
                                journals.journalCode,\
                                subscriber_type.subtypecode,\
                                subscriber.subscriberNumber,\
                                subscriber.subscriberName,\
                                subscriber.department,\
                                subscriber.institution,\
                                subscriber.shippingAddress,\
                                cities.city,\
                                districts.district,\
                                states.state,\
                                countries.country,\
                                subscriber.pincode,\
                                subscriptiondetails.copies,\
                                subscriptiondetails.startYear,\
                                subscriptiondetails.startMonth,\
                                subscriptiondetails.endYear,\
                                subscriptiondetails.endMonth \
                           FROM subscriptiondetails \
                                LEFT JOIN subscription \
                                   ON subscriptiondetails.subscriptionID = subscription.id \
                                LEFT JOIN subscriber \
                                   ON subscription.subscriberID = subscriber.id \
                                LEFT JOIN subscriber_type \
                                   ON subscriber.subtype = subscriber_type.id \
                                LEFT JOIN journal_groups \
                                   ON subscriptiondetails.journalGroupID = journal_groups.id \
                                RIGHT JOIN journal_group_contents \
                                   ON journal_group_contents.journalGroupId = journal_groups.id \
                                LEFT JOIN journals \
                                   ON journal_group_contents.journalId = journals.id \
                                LEFT JOIN cities \
                                   ON subscriber.city = cities.id \
                                LEFT JOIN countries \
                                   ON subscriber.country = countries.id \
                                LEFT JOIN districts \
                                   ON subscriber.district = districts.id \
                                LEFT JOIN states \
                                   ON subscriber.state = states.id \
                          WHERE     subscriptiondetails.active = true \
                                AND journals.journalName = ? \
                                AND LAST_DAY(concat(?,\
                                                    '-',\
                                                    (SELECT id \
                                                       FROM months \
                                                      WHERE month = ?),\
                                                    '-',\
                                                    '01')) BETWEEN DATE_FORMAT( \
                                                                      concat(\
                                                                         subscriptiondetails.startYear,\
                                                                         '-',\
                                                                         subscriptiondetails.startMonth,\
                                                                         '-',\
                                                                         '1'),\
                                                                      '%Y/%m/%d') \
                                                               AND LAST_DAY(\
                                                                      concat(\
                                                                         subscriptiondetails.endYear,\
                                                                         '-',\
                                                                         subscriptiondetails.endMonth,\
                                                                         '-',\
                                                                         '1'))\

insert_ml = insert into mailing_list (journalId, issue, `year`, month, volumeNumber) values \
            ((select id from journals where journals.journalName = ?),?,?,(select id from months where months.month = ?), ?)

insert_mldtl = insert into mailing_list_detail (mailinglistId, subscriberId, subscriptionId, subscriptionDetailId, \
                journalId, journalCode, subtypecode, subscriberNumber, subscriberName, department, institution, address, city, district, state, \
                country, pincode, copies, startYear, startMonth, endYear, endMonth, volumeNumber, issue, month, `year`) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, \
                (select id from months where months.month = ?), ?)

search_ml =select journalId, issue, `year`, month, mlDate FROM mailing_list where journalId = ? AND issue = ? AND `year` = ? \
            AND month = ? and bilid = ' '

get_ml =select id, journalId, issue, `year`, month, mlDate FROM mailing_list where \
                journalId =  (select id from journals where journals.journalName = ?) \
        and issue = ?

check_ml =select id FROM mailing_list where \
          journalId =  (select id from journals where journals.journalName = ?) \
          and `year` = ? and volumeNumber = ? and issue = ?

search_mldtl = select ml.id, journalCode, ml.subtypecode, subscriberNumber, subscriberName, department , institution, \
                 address, city, district, state, country, pincode, copies, volumeNumber, issue, month, `year`, startYear, \
                left((select month from months where months.Id = startMonth), 3) as startMonth, endYear, \
               left((select month from months where months.Id = endMonth), 3) as endMonth, subscriber_type.subtype as subType \
                 FROM mailing_list_detail ml, subscriber_type where mailinglistid = ? and ml.subtypecode = subscriber_type.subtypecode


get_ml_id = select id from mailing_list where journalId = (select id from journals where journals.journalName = ?) and \
             issue = ? and `year` = ? and month = (select id from months where months.month = ?)

search_mldtl_ui = select journalCode, subtypecode, subscriberNumber, subscriberName, city, state, country, pincode, copies, volumeNumber, issue, month, `year` \
                FROM mailing_list_detail where mailinglistid = ? and miId = 0 and bilid = 0

#--------------------------------------------------------------------------
# End Mailing List
#--------------------------------------------------------------------------

#--------------------------------------------------------------------------
# Start Back Issue List
#--------------------------------------------------------------------------
subscribernumber =  select distinct subscriber.subscriberNumber \
                    from  subscriber,\
                        back_issue_list,\
                        subscription,\
                        subscriptiondetails \
                    where back_issue_list.subscription_detail_id = subscriptiondetails.id \
                        and back_issue_list.sent_to_subscriber = false \
                        and subscriptiondetails.subscriptionID = subscription.id \
                        and subscription.subscriberID = subscriber.id \
                    group by subscriber.subscriberNumber

subscribernumberbil =   select distinct subscriber.subscriberNumber \
                        from  subscriber,\
                            back_issue_list, \
                            subscription, \
                            subscriptiondetails \
                        where back_issue_list.subscription_detail_id = subscriptiondetails.id \
                            and back_issue_list.sent_to_subscriber = true \
                            and subscriptiondetails.subscriptionID = subscription.id \
                            and subscription.subscriberID = subscriber.id \
                        group by subscriber.subscriberNumber


generate_bil = select mailing_list.id, \
                        subscriber.id, \
                        subscription.id, \
                        subscriptiondetails.id, \
			journals.id, \
			journals.journalCode, \
                        subscriber_type.subtypecode, \
                        subscriber.subscriberNumber, \
			subscriber.subscriberName, \
                        subscriber.department, \
			subscriber.institution, \
			subscriber.shippingAddress, \
                        cities.city, \
			districts.district, \
			states.state, \
                        countries.country, \
                        subscriber.pincode, \
                        back_issue_list.copies, \
                        subscriptiondetails.startYear, \
                        subscriptiondetails.startMonth, \
                        subscriptiondetails.endYear, \
                        subscriptiondetails.endMonth, \
                        back_issue_list.volume_number, \
                        back_issue_list.issue_number, \
                        back_issue_list.month, \
                        back_issue_list.`year`, \
                        back_issue_list.id \
                FROM  back_issue_list, \
                        mailing_list, \
                        subscriptiondetails left join subscription on subscriptiondetails.subscriptionID = subscription.id \
                        left join subscriber on subscription.subscriberID = subscriber.id \
                        left join subscriber_type on subscriber.subtype = subscriber_type.id \
                        left join journal_groups on subscriptiondetails.journalGroupID = journal_groups.id \
                        right join journal_group_contents on journal_group_contents.journalGroupId = journal_groups.id \
                        left join journals on journal_group_contents.journalId = journals.id \
                        left join cities on subscriber.city = cities.id \
                        left join states on subscriber.state = states.id \
                        left join countries on subscriber.country = countries.id \
                        left join districts on subscriber.district = districts.id \
                        where back_issue_list.`year` = mailing_list.`year` \
                       and back_issue_list.issue_number = mailing_list.issue \
                        and back_issue_list.volume_number = mailing_list.volumeNumber \
                        and back_issue_list.month = mailing_list.month \
                        and back_issue_list.sent_to_subscriber = false \
                        and back_issue_list.subscription_detail_id = subscriptiondetails.id \
                        and back_issue_list.journal_id = journals.id \
                        and mailing_list.journalId = journals.id \
                        and subscriptiondetails.active = true

insert_mldtl_bil = insert into mailing_list_detail \
                    ( mailinglistId, subscriberId, subscriptionId, subscriptionDetailId, journalId, journalCode, \
                    subtypecode, subscriberNumber, subscriberName, department, institution, address, city, district, \
                    state, country, pincode, copies, startYear, startMonth, endYear, endMonth, volumeNumber, issue, month, \
                    `year`, bilid, bildate) \
                    VALUES \
                    ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, \
                    ?, ?, ?, ?, ? )

update_bil = update back_issue_list SET sent_to_subscriber = true, sent_on = curdate() WHERE Id = ?

search_bil = select mailing_list_detail.id, mailing_list_detail.subscriptionId, mailing_list_detail.journalCode, subscriber_type.subtypecode, subscriberNumber, subscriberName, department , institution, \
                address, city, district, state, country, pincode, mailing_list_detail.copies, mailing_list_detail.issue, \
                mailing_list_detail.month, mailing_list_detail.`year`, mailing_list_detail.startYear, \
                left((select month from months where months.Id = mailing_list_detail.startMonth), 3) as startMonth, \
                mailing_list_detail.endYear, left((select month from months where months.Id = mailing_list_detail.endMonth), 3) as endMonth, \
                subscriber_type.subtype as subType, mailing_list_detail.volumeNumber, journal_details.page_size \
                    FROM \
                mailing_list_detail, subscriptiondetails, back_issue_list, subscriber_type, journals, journal_details, journal_volume_details \
                where mailing_list_detail.subscriptionDetailId = subscriptiondetails.id and subscriptiondetails.active = '1' \
                and mailing_list_detail.subtypecode = subscriber_type.subtypecode \
                and mailing_list_detail.bilid = back_issue_list.id \
                and  mailing_list_detail.startYear >= subscriptiondetails.startYear \
                and mailing_list_detail.bilid <> ' ' and journal_details.journals_id = journals.id \
                and mailing_list_detail.journalId = journals.id \
                 and journal_volume_details.journal_details_id = journal_details.id \
                and mailing_list_detail.volumeNumber = journal_volume_details.volume_number

search_bil_ui = select mailing_list_detail.subscriptionId, mailing_list_detail.journalCode, mailing_list_detail.subtypecode, \
                mailing_list_detail.subscriberNumber, mailing_list_detail.subscriberName, \
                mailing_list_detail.city, mailing_list_detail.state, mailing_list_detail.country, \
                mailing_list_detail.pincode, mailing_list_detail.copies, mailing_list_detail.volumeNumber, mailing_list_detail.issue, \
                mailing_list_detail.month, mailing_list_detail.`year`, mailing_list_detail.bildate, \
                journal_details.page_size FROM mailing_list_detail, subscriptiondetails, back_issue_list, journals, journal_details, journal_volume_details \
                where mailing_list_detail.subscriptionDetailId = subscriptiondetails.id \
                and subscriptiondetails.active = '1' and mailing_list_detail.bilid = back_issue_list.id and \
                mailing_list_detail.startYear >= subscriptiondetails.startYear and mailing_list_detail.bilid <> ' ' \
                and journal_details.journals_id = journals.id and mailing_list_detail.journalId = journals.id \
                and journal_volume_details.journal_details_id = journal_details.id \
                and mailing_list_detail.volumeNumber = journal_volume_details.volume_number
#--------------------------------------------------------------------------
# End Back Issue List
#--------------------------------------------------------------------------

# -------------------------------------------------------------------------
#Reminders
#--------------------------------------------------------------------------

get_susbcriber_for_rem1 = Select distinct subscription.id from subscription, subscriptiondetails \
                            where subscriptiondetails.subscriptionID = subscription.id \
                            and subscription.active and subscriptiondetails.endYear >= year(curdate()) \
                            and subscription.id not in ( select reminders.subscriptionId from reminders) \
                            and subscription.legacy <> 1

get_susbcriber_for_rem2 = SELECT distinct subscription.id \
                            FROM subscriber, subscription, subscriptiondetails, subscriber_type, reminders \
                            WHERE subscriptiondetails.subscriptionID = subscription.id \
                            AND subscription.subscriberID = subscriber.id AND subscriptiondetails.endYear >= year(CURDATE()) \
                            AND subscriber.subtype = subscriber_type.id AND subscriber_type.subtype = 'Paid' \
                            AND reminders.subscriptionId = subscription.id and reminders.reminderType = '1' \
                            and reminders.reminderType <> '2' and reminders.reminderType <> '3'

get_susbcriber_for_rem2 = SELECT distinct subscription.id \
                            FROM subscriber, subscription, subscriptiondetails, subscriber_type, reminders \
                            WHERE subscriptiondetails.subscriptionID = subscription.id \
                            AND subscription.subscriberID = subscriber.id AND subscriptiondetails.endYear >= year(CURDATE()) \
                            AND subscriber.subtype = subscriber_type.id AND subscriber_type.subtype = 'Paid' \
                            AND reminders.subscriptionId = subscription.id \
                            and reminders.reminderType = '2' and reminders.reminderType <> '3'

get_subscription_total =  SELECT (sum(subscription_rates.rate * subscriptiondetails.copies)) as subscription_total \
           FROM subscriptiondetails, journal_groups, subscription_rates, subscription, subscriber \
            WHERE subscriptiondetails.journalGroupID = journal_groups.id \
            AND subscription_rates.journalGroupId = journal_groups.id \
               AND subscription_rates.`year` = subscriptiondetails.startYear \
               AND (  subscriptiondetails.endYear \
                    - subscriptiondetails.startYear \
                    + 1) = subscription_rates.period \
                AND subscriptiondetails.subscriptionID = subscription.id \
               AND subscription.subscriberID = subscriber.id \
               AND subscriber.subtype = subscription_rates.subtypeId \
               and subscription.id = ? \
               group by subscriptiondetails.subscriptionID

get_payment_total = SELECT sum(inward.amount) as payment_total \
                    FROM payment, inward, subscription, inward_purpose \
                    WHERE payment.inwardId = inward.id AND payment.subscriptionId = subscription.id \
                    AND (   inward_purpose.purpose = 'New Subscription' OR inward_purpose.purpose = 'Renew Subscription' \
                    OR inward_purpose.purpose = 'Payment' OR inward_purpose.purpose = 'Request For Invoice') \
                    AND inward.inwardPurpose = inward_purpose.id AND subscription.id = ? \
                    GROUP BY subscription.id, inward.id;

insert_rem = INSERT INTO reminders(subscriptionId, balance, reminderType, reminderDate) \
                VALUES (?, ?, ?, curdate())




gen_reminders_subscriber =  select subscription.id as subId, subscriber_type.subtypecode, subscriber.subscriberNumber, \
                                subscriber.subscriberName, reminders.balance, reminders.reminderType, reminders.reminderDate, \
                                subscriber.email, reminders.id \
                                from reminders, subscription, \
                                subscriber, subscriber_type \
                                where \
                                subscription.subscriberID = subscriber.id and reminders.subscriptionId = subscription.id \
                                and subscriber.subtype = subscriber_type.id \
                                and reminders.reminderType = ?

get_reminders_subscriber =  select subscriber.id, subscription.id as subId, subscriber_type.subtypecode, subscriber.subscriberNumber, \
                                subscriber.subscriberName, reminders.balance, reminders.reminderType, reminders.reminderDate, \
                                 subscriber.department, subscriber.institution, subscriber.shippingAddress, \
                                cities.city, districts.district, states.state, countries.country, subscriber.pincode, \
                                subscriber.email, reminders.id \
                                from reminders, subscription, \
                                subscriber left join cities on subscriber.city = cities.id \
                                left join states on subscriber.state = states.id \
                                left join countries on subscriber.country = countries.id \
                                left join districts on subscriber.district = districts.id, subscriber_type \
                                where \
                                subscription.subscriberID = subscriber.id and reminders.subscriptionId = subscription.id \
                                and subscriber.subtype = subscriber_type.id and year(reminders.reminderDate)= year(curdate()) \
                                and reminders.reminderType = ?


insert_reminder_details = insert into reminder_details ( reminderId, medium, language, sent_date) \
                            VALUES (?, ?, ?, curdate())

get_subscribed_journals = select journals.journalName, subscriptiondetails.startYear, \
                         subscriptiondetails.startMonth, subscriptiondetails.endMonth, \
                        subscriptiondetails.endYear, subscriptiondetails.copies \
                        from reminders, subscription, subscriptiondetails, journal_groups, \
                        journal_group_contents, journals \
                        where reminders.subscriptionId = subscription.id \
                        and subscriptiondetails.subscriptionID = subscription.id \
                        and subscriptiondetails.journalGroupID = journal_groups.id \
                        and journal_group_contents.journalGroupId = journal_groups.id \
                        and journal_group_contents.journalId = journals.id and reminders.id = ?


get_subscriber_reminders = select subscription.id as subscriptionid, reminders.balance, reminderType as rtype, date_format(reminders.reminderDate, "%d/%m/%Y") as rdate, date_format(reminder_details.sent_date, "%d/%m/%Y") as sdate, \
                            if (reminder_details.medium  = "E", "EMail", "Print") as medium \
                            FROM reminders, reminder_details, subscription, subscriber \
                            where reminder_details.reminderId = reminders.id and reminders.subscriptionId = subscription.id \
                            and subscription.subscriberID = subscriber.id and subscriber.subscriberNumber = ?

#------------------------------------------------------------------------------
#End Reminders
#------------------------------------------------------------------------------

#--------------------------------------------------------------------------
# Missing Issue List
#--------------------------------------------------------------------------
insert_missing_issue = insert into missing_issue ( inwardId, subscriberId,msEntryDate ) \
                        VALUES ( (select id from inward where inward.inwardNumber = ?), \
                        (select id from subscriber where subscriber.subscriberNumber = ?), curdate())

insert_missing_journals = insert into missing_issue_journals ( missingissueId, subscriptiondetailId, journalGroupId, journalId, issue, `year`, missingCopies, mailinglistid, volumeNo ) \
                            VALUES ( ?, \
                            (select subscriptiondetails.id from subscriptiondetails, journal_groups where \
                                subscriptiondetails.subscriptionID = ? \
                                 and subscriptiondetails.journalGroupID =  journal_groups.id and \
                                    journal_groups.journalGroupName = ?), \
                              (select id from journal_groups where journal_groups.journalGroupName = ?), \
                              (select id from journals where journalName = ?), \
                            ?, ?, ?, ?, ?)


get_subscriptionid = select subscription.id from subscription, subscriber where \
                        subscription.subscriberID = subscriber.id and subscriber.subscriberNumber = ?

get_journalgroup = select journal_groups.journalGroupName from journal_groups, subscriptiondetails \
                    where subscriptiondetails.journalGroupID = journal_groups.id and subscriptiondetails.subscriptionID = ? \
                    and subscriptiondetails.active = 1 and subscriptiondetails.endYear >= year(curdate())

get_journalname = select journalName from journals, journal_group_contents, journal_groups \
                    where journal_group_contents.journalGroupId = journal_groups.id and journal_group_contents.journalId = journals.id \
                and journal_groups.journalGroupName = ?

get_copies = select subscriptiondetails.copies from subscriptiondetails, journal_groups \
            where subscriptiondetails.journalGroupID = journal_groups.id \
            and journal_groups.journalGroupName = ? and subscriptiondetails.subscriptionID = ?

get_missing_journals = select subscriptiondetails.id, journal_groups.journalGroupName, journals.journalCode, \
                        journals.journalName, subscriptiondetails.copies, missing_issue_journals.issue, \
                        missing_issue_journals.`year`, missing_issue_journals.volumeNo, missing_issue_journals.missingCopies, \
                        subscriptiondetails.startYear, subscriptiondetails.endMonth, subscriptiondetails.startMonth, \
                        subscriptiondetails.endYear, if(missing_issue_journals.mailinglistid = 0, "Generate", "Reprint") as action \
                        from missing_issue_journals, subscriptiondetails, journal_groups, journals \
                        where missing_issue_journals.subscriptiondetailId = subscriptiondetails.id \
                        and missing_issue_journals.journalGroupId = journal_groups.id \
                        and missing_issue_journals.journalId = journals.id and missing_issue_journals.missingissueId = ?

get_subscriber_detail = select subscriber.subscriberName, subscriber.department, subscriber.institution, \
                        subscriber.shippingAddress, cities.city, districts.district, states.state, \
                        countries.country, subscriber.pincode, subscriber.email, subscriber_type.subtypedesc \
                        from subscriber left join states on subscriber.state = states.id \
                        left join cities on subscriber.city = cities.id \
                        left join countries on subscriber.country = countries.id \
                        left join districts on subscriber.district = districts.id \
                        left join subscriber_type on subscriber.subtype = subscriber_type.id \
                        where subscriber.subscriberNumber = ?

complete_inward = update inward set completed = true where inwardNumber = ?

update_missing_action = update missing_issue_journals SET action = ?, sentOn = curdate() WHERE missingissueId = ?

reprint_mi_list = select mailing_list_detail.id, mailing_list_detail.mailinglistId, mailing_list_detail.subscriberId, \
                 mailing_list_detail.subscriptionId, mailing_list_detail.subscriptionDetailId, mailing_list_detail.journalId, \
                 mailing_list_detail.journalCode, mailing_list_detail.subtypecode, mailing_list_detail.subscriberNumber, \
                 mailing_list_detail.subscriberName, mailing_list_detail.department, mailing_list_detail.institution, \
                 mailing_list_detail.address, mailing_list_detail.city, mailing_list_detail.district, mailing_list_detail.state, \
                 mailing_list_detail.country, mailing_list_detail.pincode, mailing_list_detail.copies, mailing_list_detail.startYear, \
                 mailing_list_detail.startMonth, mailing_list_detail.endYear, mailing_list_detail.issue, mailing_list_detail.endMonth, \
                 mailing_list_detail.month, mailing_list_detail.`year`, subscriber_type.subtype \
                 from missing_issue_journals, mailing_list_detail, subscriber_type \
                 where mailing_list_detail.journalId = missing_issue_journals.journalId \
                 and mailing_list_detail.subscriptionDetailId = missing_issue_journals.subscriptiondetailId \
                 and mailing_list_detail.issue = missing_issue_journals.issue and mailing_list_detail.`year`= missing_issue_journals.`year` \
                 and mailing_list_detail.subtypecode = subscriber_type.subtypecode \
                 and missing_issue_journals.missingissueId = ?

reprint_mi_list_action = select mailing_list_detail.id, mailing_list_detail.mailinglistId, mailing_list_detail.subscriberId, \
                 mailing_list_detail.subscriptionId, mailing_list_detail.subscriptionDetailId, mailing_list_detail.journalId, \
                 mailing_list_detail.journalCode, mailing_list_detail.subtypecode, mailing_list_detail.subscriberNumber, \
                 mailing_list_detail.subscriberName, mailing_list_detail.department, mailing_list_detail.institution, \
                 mailing_list_detail.address, mailing_list_detail.city, mailing_list_detail.district, mailing_list_detail.state, \
                 mailing_list_detail.country, mailing_list_detail.pincode, mailing_list_detail.copies, mailing_list_detail.startYear, \
                 mailing_list_detail.startMonth, mailing_list_detail.endYear, mailing_list_detail.issue, mailing_list_detail.endMonth, \
                 mailing_list_detail.month, mailing_list_detail.`year`, subscriber_type.subtype \
                 from missing_issue_journals, mailing_list_detail, subscriber_type \
                 where mailing_list_detail.journalId = missing_issue_journals.journalId \
                 and mailing_list_detail.subscriptionDetailId = missing_issue_journals.subscriptiondetailId \
                 and mailing_list_detail.issue = missing_issue_journals.issue and mailing_list_detail.`year`= missing_issue_journals.`year` \
                 and mailing_list_detail.subtypecode = subscriber_type.subtypecode and (missing_issue_journals.mailinglistid <> 0 or missing_issue_journals.mailinglistid <> null) \
                 and missing_issue_journals.missingissueId = ?

generate_ml = select mailing_list.id, subscriber.id, subscription.id, subscriptiondetails.id, journals.id, \
                journals.journalCode,subscriber_type.subtypecode, subscriber.subscriberNumber, subscriber.subscriberName, \
                subscriber.department, subscriber.institution, subscriber.shippingAddress, cities.city, districts.district, \
                states.state, countries.country, subscriber.pincode, missing_issue_journals.missingCopies, subscriptiondetails.startYear, \
                subscriptiondetails.startMonth, subscriptiondetails.endYear, subscriptiondetails.endMonth, missing_issue_journals.volumeNo, \
                mailing_list.month, missing_issue_journals.issue, \
                missing_issue_journals.`year`, missing_issue_journals.id, \
                subscriber_type.subtype \
                from mailing_list, missing_issue_journals, missing_issue, \
                subscriptiondetails, subscription, journals, subscriber_type, \
                subscriber left join cities on subscriber.city = cities.id \
                left join states on subscriber.state = states.id \
                left join countries on subscriber.country = countries.id \
                left join districts on subscriber.district = districts.id \
                where \
                mailing_list.journalId = journals.id \
                and missing_issue_journals.journalId = journals.id \
                and missing_issue_journals.journalId = mailing_list.journalId \
                and missing_issue_journals.subscriptiondetailId = subscriptiondetails.id \
                and missing_issue_journals.issue = mailing_list.issue and missing_issue_journals.`year` = mailing_list.`year` \
                and missing_issue_journals.volumeNo = mailing_list.volumeNumber \
                and subscriptiondetails.subscriptionID = subscription.id and subscription.subscriberID = subscriber.id \
                and missing_issue_journals.subscriptiondetailId = subscriptiondetails.id and missing_issue.subscriberId = subscriber.id \
                and missing_issue_journals.missingissueId = missing_issue.id and (missing_issue_journals.mailinglistid = 0 or missing_issue_journals.mailinglistid = null) \
                and subscriber.subtype = subscriber_type.id and missing_issue_journals.missingissueId = ?

insert_mldtl_mil = insert into mailing_list_detail \
                    ( mailinglistId, subscriberId, subscriptionId, subscriptionDetailId, journalId, journalCode, \
                    subtypecode, subscriberNumber, subscriberName, department, institution, address, city, district, \
                    state, country, pincode, copies, startYear, startMonth, endYear, endMonth, volumeNumber, issue, month, \
                    `year`, miId, bildate) \
                    VALUES \
                    ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, \
                    ?, ?, ?, ?, curdate())

get_month_mi = select months.month from months, mailing_list, journals \
            where mailing_list.journalId = journals.id \
                and mailing_list.month = months.id and journals.journalName = ? and mailing_list.`year` = ?

get_volume_mi = select journal_volume_details.volume_number \
                from journals, journal_volume_details, mailing_list, journal_details \
                where mailing_list.volumeNumber = journal_volume_details.volume_number \
                and journal_volume_details.journal_details_id = journal_details.id \
                and journal_details.journals_id = journals.id \
                and mailing_list.journalId = journals.id \
                and journals.journalName = ? and mailing_list.`year` = ?

get_issue_mi = Select issueNumber from issues where issues.issueNumber <= (select max(mailing_list.issue) \
                FROM mailing_list, journals, journal_details \
                where mailing_list.journalId = journals.id \
                and journal_details.journals_id = journals.id \
                and journals.journalName = ? and mailing_list.`year` = ? \
               and mailing_list.volumeNumber = ?)

get_miId_for_inward = Select missing_issue.id, subscriber.subscriberNumber \
                        FROM missing_issue, inward, subscriber \
                        where \
                        missing_issue.inwardId = inward.id \
                        and missing_issue.subscriberId = subscriber.id and inward.inwardNumber = ?

get_ml_id_for_mi = select mailing_list_detail.id from mailing_list_detail, journals \
                    where mailing_list_detail.journalId = journals.id and subscriptionId = ? \
                    AND journals.journalName = ? AND `year` = ? AND issue = ?

check_mailing_status = select missing_issue_journals.id from missing_issue_journals where missingissueId = ? and (mailinglistid = 0 or mailinglistid = null)
#--------------------------------------------------------------------------
# End Missing Issue List
#-------------------------------------- --   ----------------------------------


#--------------------------------------------------------------------------
# Data Validation from DB
#--------------------------------------------------------------------------
 validate_city = select * from cities where city = ?
 validate_district = select * from districts where district = ?
 validate_country = select * from countries where country = ?
 validate_state = select * from states where state = ?
 validate_subscriberno = select * from subscriber where subscriberNumber = ?
 validate_subtype = select * from subscriber_type where subtype = ? and subtypedesc = ?

# ------------------------
# Please refer list
# ------------------------
get_pl_refer_list = SELECT \
                        t1.subscriberID, \
                        t2.subscriptionID \
                      FROM \
                        subscription t1, \
                        subscriptiondetails t2, \
                        subscriber t3, \
                        subscriber_type t4 \
                      WHERE \
                        t1.id = t2.subscriptionID AND \
                        t1.subscriberID = t3.id AND \
                        t3.subtype = t4.id AND \
                        t4.subtype <> 'Free' AND \
                        t2.endYear = YEAR(CURDATE()) \
                      GROUP BY \
                        t1.subscriberID, \
                        t2.subscriptionID

get_pl_refer_list_for_email_and_all = SELECT \
                                        t3.id AS subscriberID, \
                                        t3.subscriberNumber, \
                                        t6.invoiceNumber, \
                                        t3.subscriberName, \
                                        t4.id AS subscriptionID, \
                                        t3.email, \
                                        t5.endYear, \
                                        t2.id as prl_id, \
                                        t1.ctext, \
                                        t2.by_email, \
                                        t6.amount \
                                      FROM \
                                        prl t1, \
                                        prl_details t2, \
                                        subscriber t3, \
                                        subscription t4, \
                                        subscriptiondetails t5, \
                                        invoice t6 \
                                      WHERE \
                                        t1.id = t2.prl_id AND \
                                        t2.invoice_id = t6.id AND \
                                        t4.subscriberID = t3.id AND \
                                        t6.subscriptionId = t4.id AND \
                                        t4.id = t5.subscriptionID AND \
                                        t1.year = YEAR(CURDATE()) AND \
                                        t5.endYear = YEAR(CURDATE()) AND \
                                        t3.email LIKE ? \
                                      GROUP BY \
                                        subscriberID, \
                                        invoiceNumber, \
                                        subscriptionID

get_pl_refer_list_for_print_only = SELECT \
                                        t3.id AS subscriberID, \
                                        t3.subscriberNumber, \
                                        t6.invoiceNumber, \
                                        t3.subscriberName, \
                                        t4.id AS subscriptionID, \
                                        t3.email, \
                                        t5.endYear, \
                                        t2.id as prl_id, \
                                        t1.ctext, \
                                        t6.amount \
                                      FROM \
                                        prl t1, \
                                        prl_details t2, \
                                        subscriber t3, \
                                        subscription t4, \
                                        subscriptiondetails t5, \
                                        invoice t6 \
                                      WHERE \
                                        t1.id = t2.prl_id AND \
                                        t2.invoice_id = t6.id AND \
                                        t4.subscriberID = t3.id AND \
                                        t6.subscriptionId = t4.id AND \
                                        t4.id = t5.subscriptionID AND \
                                        t1.year = YEAR(CURDATE()) AND \
                                        t5.endYear = YEAR(CURDATE()) AND \
                                        (t3.email = ? OR t3.email IS NULL) \
                                      GROUP BY \
                                        subscriberID, \
                                        invoiceNumber, \
                                        subscriptionID

get_prl_id_for_current_year = SELECT \
                                id \
                              FROM \
                                prl \
                              WHERE \
                                year = year(CURDATE())

update_prl_email_status = UPDATE prl_details \
                            SET by_email = TRUE \
                          WHERE invoice_id = (SELECT id \
                                                FROM invoice \
                                               WHERE invoice.invoiceNumber = ?)

get_email_ids = select email \
                from subscriber, subscriber_type \
                where email is not null and email <> "" \
                and subscriber.subtype = subscriber_type.id

is_free_subscriber = SELECT \
                        count(1) \
                      FROM \
                        subscriber_type \
                      WHERE \
                        id = ? AND \
                        subtype = 'Free' \
                      LIMIT \
                        1

get_journal_grp_price = SELECT \
                            t1.rate \
                          FROM \
                            subscription_rates t1 \
                          WHERE \
                            t1.journalGroupId = ? AND \
                            t1.subtypeId = ? AND \
                            t1.`year` = ? AND \
                            t1.period = ?

get_journal_group_price_for_minimum_period = SELECT min(t1.period) as period \
                                                FROM subscription_rates t1 \
                                               WHERE t1.journalGroupId = ? AND t1.subtypeId = ? AND t1.year = ?

insert_payment = INSERT INTO payment(inwardID, \
                    invoice_id, \
                    amount, \
                    remarks) \
                    VALUES (?, \
                            ?, \
                            ?, \
                            ?)

invoice_payments =   SELECT t1.id, \
                            t2.inwardNumber, \
                            t2.amount AS inwardAmount, \
                            t1.amount AS paymentAmount, \
                            t1.remarks, \
                            DATE_FORMAT(t1.`date`,'%d/%m/%Y') AS paymentDate, \
                            t1.invoice_id \
                       FROM payment t1, inward t2 \
                      WHERE t1.invoice_id = ? AND t1.inwardID = t2.id \
                     GROUP BY t1.id

get_payments_for_subscription = SELECT t1.invoiceNumber, \
                                        t1.amount AS invoiceAmount, \
                                        t4.inwardNumber, \
                                        t4.amount AS inwardAmount, \
                                        t3.amount AS paymentAmount, \
                                        DATE_FORMAT(t3.`date`, '%d/%m/%Y') AS paymentDate, \
                                        t3.remarks \
                                   FROM invoice t1, payment t3, inward t4 \
                                  WHERE     t3.invoice_id = t1.id \
                                        AND t3.inwardID = t4.id \
                                        AND t1.subscriptionid = ?

getJournalName = select journalName from journals
get_journal_details = select pages, issues, page_size, no_of_volumes from journal_details where journals_id = (select journals.id from journals where journals.journalName = ?) and journal_details.`year` = ?
check_if_journal_details_exist = select id from journal_details where journals_id = (select id from journals where journals.journalName = ?) and `year` = ?
update_journal_details = update journal_details set pages = ?, issues = ?, page_size = ?, no_of_volumes = ? where id = ?
insert_journal_details = insert into journal_details (journals_id, year, pages, issues, page_size, no_of_volumes ) values ((select id from journals where journalName = ?),?,?,?,?,?)
get_months = select month from months
get_journal_volume_details = select id, volume_number, start_month from journal_volume_details where journal_details_id = ?
get_journal_details_id = select id, no_of_volumes from journal_details where journals_id = (select id from journals where journals.journalName = ?) and `year` = ?
get_journal_volume_details_id = select id from journal_volume_details where journal_details_id = (select id from journal_details where journal_details.`year`=? and journal_details.journals_id = (select id from journals where journals.journalName = ?))
insert_journal_volume_details = insert into journal_volume_details (journal_details_id, volume_number, start_month) values ((select id from journal_details where journals_id = (select id from journals where journalName = ?) and journal_details.`year` = ?),?,?)
update_journal_volume_details = update journal_volume_details set volume_number = ?, start_month = ? where id = ?

