# To change this template, choose Tools | Templates
# and open the template in the editor.
# To change this template, choose Tools | Templates
# and open the template in the editor.
# a comment
! a comment
#a = a string
#b = a string with escape sequences \t \n \r \\ \" \' \ (space) \u0123
#c = a string with a continuation line \
#    continuation line
#d.e.f = another string

#--------------------------------------------------------------------------
# Master Data
#--------------------------------------------------------------------------

! Generic ------------------------------------------------------

logged_in_user = select firstName, lastName from users where username = ?

purpose = select purpose from inward_purpose order by id

payment_mode = select payment_mode from payment_mode order by id

currency = select currency from currency order by id

return_reason = select return_reason from inward_return_reasons order by id

language = select language from languages order by id

month = select month from months order by id

journalname = select journalName from journals order by id

! End Generic ------------------------------------------------------


! City ------------------------------------------------------
city = select city from cities

search_city = select id, city from cities where city like ?

city_insert = insert into cities(city) values(?)

get_city_by_name = select id, city from cities where city = ?

get_city_by_id = select id, city from cities where id = ?

update_city = update cities set city = ? where id = ?

! End City----------------------------------------------------


!District ------------------------------------------------------
search_district = select id, district from districts where district like ?

district = select district from districts

district_insert = insert into districts(district) values(?)

get_district_by_name = select id, district from districts where district = ?

get_district_by_id = select id, district from districts where id = ?

update_district = update districts set district = ? where id = ?
! End District----------------------------------------------------


!State ------------------------------------------------------
search_state = select id, state from states where state like ?

state =  select state from states

state_insert = insert into states(state) values(?)

get_state_by_name = select id, state from states where state = ?

get_state_by_id = select id, state from states where id = ?

update_state = update states set state = ? where id = ?

! End State----------------------------------------------------



! Country------------------------------------------------------
country = select country from countries

country_insert = insert into countries(country) values(?)

get_country_by_name = select id, country from countries where country = ?

get_country_by_id = select id, country from countries where id = ?

update_country = update countries set country = ? where id = ?

search_country = select id, country from countries where country like ?
! End Country----------------------------------------------------


! Journal------------------------------------------------------
journals = select journalName,journalCode from journals

journal_groups = select id,journalGroupName from journal_groups order by id

journal_name = select journalName from journals

journalName = select journalName from journals

journal_insert = insert into journals(journalCode,journalName,issnNo,pages,startYear,issues) values(?,?,?,?,?,?)

update_journal = update journals set journalCode = ?, journalName = ?, issnNo = ?, pages = ?, startYear = ?, issues = ? where id = ?

get_journal_by_name = select id, journalCode, journalName, issnNo, pages, startYear, issues from journals where journalCode = ? and journalName = ? and issnNo = ? and pages = ? and startYear = ? and issues = ?

get_journal_by_id = select id, journalCode, journalName, issnNo, pages, startYear, issues from journals where id = ?

search_journal = select id, journalCode, journalName, issnNo, pages, startYear, issues from journals where journalCode like ? or journalName like ?

! End Journal----------------------------------------------------


! Subscriber Type------------------------------------------------------
subscriber_names = select distinct subscriberName from subscriber where subscriberName like ? LIMIT 100

department_names = select distinct department from subscriber where department like ? LIMIT 100

institution_names = select distinct institution from subscriber where institution like ? LIMIT 100

sub_type = select distinct subtype from subscriber_type

subscribertype = select subtypedesc as subscriberType from subscriber_type

subscribertype1 = select concat(subtypecode, '-',  subtypedesc) as subscriberType from subscriber_type

subtype_free = select distinct subtype from subscriber_type where subtype = "Free"

subtype_desc = select distinct subtypedesc from subscriber_type where subtype = ?

subtype_desc_asf = select distinct subtypedesc from subscriber_type where subtypedesc = "Summer Fellows"

subtype_code = select subtypecode from subscriber_type where subtypedesc = ?

subType_insert = insert into subscriber_type(subtypecode,subtypedesc,subtype,nationality,institutional,freejrnl,discount) values(?,?,?,?,?,?,?)

update_subType = update subscriber_type set subtypecode = ?, subtypedesc = ?, subtype = ?, nationality = ?, institutional = ?, freejrnl = ?, discount = ? where id = ?

get_subType_by_name = select id, subtypecode, subtypedesc, subtype, nationality, institutional, freejrnl, discount from subscriber_type where subtypecode = ? and subtypedesc = ? and subtype = ? and nationality = ? and institutional = ? and freejrnl = ? discount = ?

get_subType_by_id = select id, subtypecode, subtypedesc, subtype, nationality, institutional, freejrnl, discount from subscriber_type where id = ?

search_subType = select id, subtypecode, subtypedesc, subtype, nationality, institutional from subscriber_type where subtypecode like ? or subtype like ?

get_subscriber_type = select subtype from subscriber where subscriberNumber = ?

! End Subscriber Type----------------------------------------------------


! Agent------------------------------------------------------

agent = select agentName from agents

agent_insert = insert into agents(agentName,regDate,emailId,address,cityId,districtId,stateId,countryId,pinCode,discount)\
                values(?,?,?,?,(select id from cities where city = ?),(select id from districts where district = ?),\
                (select id from states where state = ?),(select id from countries where country = ?),?, ?)

update_agent = update agents set agentName = ?, regDate = ?, address = ?, emailId = ?, \
                cityId = (select id from cities where city = ?), \
                districtId = (select id from districts where district = ?), \
                stateId = (select id from states where state = ?), \
                countryId = (select id from countries where country = ?), \
                pinCode = ?, discount = ? where id = ?

get_agent_by_name = select agentId, agentName, regDate, emailId, address, cityId, districtId, stateId, CountryId, pinCode, discount from agents \
                    where agentName = ? and regDate = ? and emailId = ? and address = ? and \
                    cityId = (select id from cities where city = ?) and \
                    districtId = (select id from districts where district = ?) and  \
                    stateId = (select id from states where state = ?) and \
                    countryId = (select id from countries where country = ?) and \
                    pinCode = ? and discount = ?

!get_agent_by_id = select id, agentName, regDate, emailId, address, cityId, districtId, stateId, CountryId, pinCode, discount from agents where agentId = ?

get_agent_by_id = select t1.id\
                    ,t1.agentName \
                    ,t1.regDate \
                    ,t1.emailId \
                    ,t1.address \
                    ,t2.city \
                    ,t3.district \
                    ,t4.state \
                    ,t5.country \
                    ,t1.pinCode \
                    ,t1.discount \
                    from agents t1 \
                    left join cities t2 on t1.cityId = t2.id \
                    left join districts t3 on t1.districtId = t3.id \
                    left join states t4 on t1.stateId = t4.id \
                    left join countries t5 on t1.countryId = t5.id \
                    where t1.id = ?

search_agent = select t1.id ,t1.agentName ,t1.regDate ,t1.emailId ,t1.address ,t2.city from agents t1 \
left join cities t2 on t1.cityId = t2.id \
where t2.city like ? and  t1.agentName like ?

! End Agent----------------------------------------------------

!Print Order -----------------------------------------------------
get_year = select distinct(year) from print_order group by year

get_print_order_by_year = select t1.id, t2.journalCode, t2.journalName, t1.year, t2.issues, t1.printOrder, (t2.issues * t1.printOrder) annualPrintOrder from print_order t1, journals t2 where t1.journalId = t2.id and t1.year = ?

!update_printOrder = update print_order set printOrder = ? where year = ? and journalId = (select id from journals where journalCode = ?)

update_printOrder = update print_order set printOrder = ? where id = ?

add_new_print_order = select id, journalCode, journalName, issues from journals

get_printOrder = select printOrder from print_order where year = ? and journalId = ?

insert_printOrder = insert into print_order (year, journalID, printOrder) values(?,?,?)

get_journal_id = select id from journals where journalCode = ?

get_print_order_id = select id from print_order where year = ? and journalId = (select id from journals where journalCode = ?)
!End Print Order --------------------------------------------------------

!Journal Group -----------------------------------------------------
journalGroupName1 = select journalGroupName from journal_groups where year = ?

journalgroupname = select journalGroupName from journal_groups

getJournalGroupId = select id from journal_groups where journalGroupName = ?

getJournalGroupContents = select journalName from journals \
where id = ANY (select journalId from journal_group_contents \
where journalGroupId = (select id from journal_groups where journalGroupName = ?))

year = select year from year

createNewJournalGroup = insert into journal_groups(journalGroupName) values(?)

getJournalId = select id from journals where journalName = ?

addToJournalGroupContents = insert into journal_group_contents(journalGroupId, journalId) values((select id from journal_groups where journalGroupName = ?), (select id from journals where journalName = ?))

checkIfJournalGroupExists = select * from journal_groups where journalGroupName = ?

checkIfJournalGroupContentExists = select * from journal_group_contents where \
journalGroupId = (select id from journal_groups where journalGroupName = ?) and \
journalId = (select id from journals where journalName = ?)

!End Print Order --------------------------------------------------------

!Annual Subscription Rate------------------------------------------------------------------------
search_subRate = select t1.id, t2.journalGroupName, t3.subtypedesc, t1.year, t1.period, t1.rate from subscription_rates t1, journal_groups t2, subscriber_type t3 \
        where t1.journalGroupId = t2.id and t1.subtypeId = t3.id and t1.year = ? and t2.journalGroupName = ? and t3.subtypedesc = ?

add_subRate = insert into subscription_rates (journalGroupId, subtypeId, year, period, rate) values \
((select id from journal_groups where journal_groups.journalGroupName = ?), \
(select id from subscriber_type where subscriber_type.subtypedesc = ?),?,?,?)

check_subRate = select id from subscription_rates \
where journalGroupId = (select id from journal_groups where journal_groups.journalGroupName = ?) and \
subtypeId = (select id from subscriber_type where subscriber_type.subtypedesc = ?) and \
year = ? and \
period = ?



!End Annual Subscription Rate-------------------------------------------------------------------------------
#--------------------------------------------------------------------------
# End Master Data
#--------------------------------------------------------------------------

#--------------------------------------------------------------------------
# Inward
#--------------------------------------------------------------------------
insert_inward = insert into inward(\
                    inwardNumber,inward.from,country,state,district,city,pincode,email,institution,department,inwardCreationDate,subscriberId,inwardPurpose,\
                    paymentMode,bankName,chqddNumber,paymentDate,amount,currency,chequeDDReturn,chequeDDReturnReason,chequeDDReturnReasonOther,receiptNumber, \
                    ackDate,remarks, language\
                )values(?,?,\
                (select id from countries where country=?),\
                (select id from states where state=?),\
                (select id from districts where district=?),\
                (select id from cities where city=?),?,?,?,?,?,\
                (select id from subscriber where subscriberNumber=?),\
                (select id from inward_purpose where purpose=?),\
                (select id from payment_mode where payment_mode=?),?,?,?,?,\
                (select id from currency where currency=?),?,\
                (select id from inward_return_reasons where return_reason=?),?,?,?,?,\
                (select id from languages where language=?))

insert_payment = insert into payment(inwardID, subscriptionID)values(?,?)

get_last_inward = SELECT inwardNumber,inwardCreationDate FROM inward ORDER BY id DESC LIMIT 1

get_inward_by_number = select t1.inwardNumber\
                      ,t1.id as InwardID \
                      ,t1.from \
                      ,t2.country \
                      ,t3.state \
                      ,t10.district \
                      ,t4.city \
                      ,t1.pincode \
                      ,t1.email \
                      ,t1.institution \
                      ,t1.department \
                      ,DATE_FORMAT(inwardCreationDate,'%d/%m/%Y') as inwardCreationDate \
                      ,t5.subscriberNumber as subscriberId \
                      ,t6.purpose as inwardPurpose \
                      ,t1.inwardPurpose as inwardPurposeID\
                      ,t7.payment_mode as paymentMode \
                      ,t1.chqddNumber \
                      ,DATE_FORMAT(t1.paymentDate,'%d/%m/%Y') as paymentDate \
                      ,t1.amount \
                      ,t8.currency \
                      ,t1.chequeDDReturn \
                      ,t9.return_reason as chequeDDReturnReason \
                      ,t1.chequeDDReturnReasonOther \
                      ,t1.receiptNumber \
                      ,DATE_FORMAT(t1.ackDate,'%d/%m/%Y') as ackDate \
                      ,t1.remarks \
                      ,t1.bankName \
                      ,DATE_FORMAT(t1.returnDate,'%d/%m/%Y') as returnDate \
                      ,t1.completed \
                      ,t11.language \
                      ,t12.subscriptionID \
                from inward t1 \
                    left join countries t2 on t1.country = t2.id \
                    left join states t3 on t1.state = t3.id \
                    left join districts t10 on t1.district = t10.id \
                    left join cities t4 on t1.city = t4.id \
                left join subscriber t5 on t1.subscriberId = t5.id \
                left join inward_purpose t6 on t1.inwardPurpose = t6.id \
                left join payment_mode t7 on t1.paymentMode = t7.id \
                left join currency t8 on t1.currency = t8.id \
                left join inward_return_reasons t9 on t1.chequeDDReturnReason = t9.id \
                left join languages t11 on t1.language = t11.id \
                left join payment t12 on t1.id=t12.inwardID \
                where t1.inwardNumber = ?

update_inward = update inward set \
                    inward.from = ?, country = (select id from countries where country = ?), state = (select id from states where state = ?), \
                    district = (select id from districts where district=?),city = (select id from cities where city=?) , pincode = ? , email = ?, institution = ? ,department = ?, \
                    subscriberId = (select id from subscriber where subscriberNumber=?), inwardPurpose = (select id from inward_purpose where purpose=?), \
                    paymentMode = (select id from payment_mode where payment_mode=?), bankName = ?, chqddNumber = ?, \
                    paymentDate = ?, amount = ?, currency = (select id from currency where currency=?), \
                    chequeDDReturn = ?, chequeDDReturnReason = (select id from inward_return_reasons where return_reason=?), \
                    chequeDDReturnReasonOther = ?, receiptNumber = ?, ackDate = ?, remarks = ?, \
                    language = (select id from languages where language = ?) \
                    where inwardNumber = ?

update_payment_info = update payment set subscriptionID=? where inwardID=(select id from inward where inwardNumber=?)

# The where/and clause is formed dynamically in the searchInward in IAS.Model.inward.java
search_inwards = select t1.id as inwardID, inwardNumber, t4.subscriberNumber as subscriberId, t1.from, DATE_FORMAT(inwardCreationDate,'%d/%m/%Y') as inwardCreationDate, t2.city as city, chqddNumber, t3.purpose as inwardPurpose, \
                t1.inwardPurpose as inwardPurposeID from inward t1 \
                left join cities t2 on t1.city = t2.id \
                left join inward_purpose t3 on t1.inwardPurpose = t3.id \
                left join subscriber t4 on t1.subscriberId = t4.id \
                where inwardNumber is not NULL

search_subscriber_inward = select t1.id, inwardNumber, DATE_FORMAT(inwardCreationDate,'%d/%m/%Y') as inwardCreationDate, t1.amount, \
                t3.purpose as inwardPurpose, t5.currency, DATE_FORMAT(ackDate,'%d/%m/%Y') as ackDate, t1.completed, t1.chequeDDReturn \
                from inward t1 left join inward_purpose t3 on t1.inwardPurpose = t3.id \
                left join subscriber t4 on t1.subscriberID = t4.id \
                left join currency t5 on t1.currency = t5.id \
                where t4.subscriberNumber = ? order by t1.id desc


search_inward_count = select count(*) from inward t1 \
                left join cities t2 on t1.city = t2.id \
                left join inward_purpose t3 on t1.inwardPurpose = t3.id \
                left join subscriber t4 on t1.subscriberId = t4.id \
                where inwardNumber is not NULL

pending_inwards = select inwardNumber, t4.subscriberNumber as subscriberId, t1.from, DATE_FORMAT(inwardCreationDate,'%d/%m/%Y') as inwardCreationDate, t2.city as city, chqddNumber, t3.purpose as inwardPurpose, \
                t1.inwardPurpose as inwardPurposeID, t1.inwardCreationDate as sortdate from inward t1 \
                left join cities t2 on t1.city = t2.id \
                left join inward_purpose t3 on t1.inwardPurpose = t3.id \
                left join subscriber t4 on t1.subscriberId = t4.id where t1.completed=false

update_cheque_return =  update inward set \
                        chequeDDReturn = ?, chequeDDReturnReason = (select id from inward_return_reasons where return_reason=?), \
                        chequeDDReturnReasonOther = ? , returnDate = ? where inwardNumber = ?

update_subscriber_in_inward = update inward set subscriberId = ? where inwardNumber = ?

update_inward_complete_flag = update inward set completed = true where id = ?

#--------------------------------------------------------------------------
# Subscriber
#--------------------------------------------------------------------------

subscriber_insert = insert into subscriber(subscriberNumber, subscriberCreationDate, subscriberName, shippingAddress, invoiceAddress,city, district, state, country, pincode, subtype, \
                    department, institution, email, agent, deactive) \
                     values (?,?,?,?,?, \
                    (select id from cities where city=?), \
                    (select id from districts where district=?), \
                    (select id from states where state=?), \
                    (select id from countries where country=?),?, \
                    (select id from subscriber_type where subtype=? and subtypedesc=?),?,?,?, \
                    (select id from agents where agentName = ?),?)

get_last_subscriber = SELECT subscriberNumber FROM subscriber where YEAR(subscriberCreationDate)=YEAR(CURDATE()) ORDER BY id DESC LIMIT 1
#SELECT subscriberNumber,subscriberCreationDate FROM subscriber ORDER BY id DESC LIMIT 1


get_subscriber_by_number = select t1.subscriberNumber\
                      ,t1.subscriberName \
                      ,DATE_FORMAT(t1.subscriberCreationDate,'%d/%m/%Y') as subscriberCreationDate \
                      ,t1.shippingAddress \
                      ,t1.invoiceAddress \
                      ,t2.city \
                      ,t3.district \
                      ,t4.state \
                      ,t5.country \
                      ,t1.pincode \
                      ,t6.subtype \
                      ,t6.subtypedesc \
                      ,t1.department \
                      ,t1.institution \
                      ,t1.email \
                      ,t7.agentName \
                      ,t1.deactive \
                      ,DATE_FORMAT(t1.deactivationDate,'%d/%m/%Y') as deactivationDate \
                from subscriber t1 \
                left join cities t2 on t1.city = t2.id \
                left join districts t3 on t1.district = t3.id \
                left join states t4 on t1.state = t4.id \
                left join countries t5 on t1.country = t5.id \
                left join subscriber_type t6 on t1.subtype = t6.id \
                left join agents t7 on t1.agent = t7.id \
                where t1.subscriberNumber = ?

update_subscriber = update subscriber set \
                subscriberName = ? \
               ,shippingAddress = ? \
               ,invoiceAddress = ? \
               ,city = (select id from cities where city = ?) \
               ,district = (select id from districts where district = ?) \
               ,state = (select id from states where state = ?) \
               ,country = (select id from countries where country = ?) \
               ,pincode = ? \
               ,subtype = (select id from subscriber_type where subtype=? and subtypedesc=?) \
               ,department = ? \
               ,institution = ? \
               ,email = ? \
               ,agent = (select id from agents where agent = ?) \
               ,deactive = ? \
                where subscriberNumber = ?

search_subscriber = select subscriberNumber, subscriberName, department, institution, t3.country, t4.state, \
                t2.city as city, pincode, email \
                from subscriber t1 \
                left join cities t2 on t1.city = t2.id \
                left join countries t3 on t1.country = t3.id \
                left join states t4 on t1.state=t4.id
#--------------------------------------------------------------------------
# Subscription
#--------------------------------------------------------------------------
get_subscription_for_subscriber =   select  t8.id, \
                                            t8.inwardNumber, \
                                            t8.subscriptionDate,(t8.amount + sum(COALESCE(t10.amount,0))) as amount, \
                                            t8.subscriptionTotal, \
                                            (t8.balance - sum(COALESCE(t10.amount,0))) as balance, \
                                            t8.currency \
                                            from \
                                            ( \
                                                select  t5.id \
                                                , t5.inwardNumber \
                                                , DATE_FORMAT(t5.subscriptionDate,'%d/%m/%Y') as subscriptionDate \
                                                , t5.amount \
                                                , sum(copies * t7.rate) as subscriptionTotal \
                                                , (sum(copies * t7.rate) - t5.amount) as balance \
                                                , t5.currency \
                                                from  ( \
                                                    select t4.subscriberName \
                                                            , t1.id \
                                                            , t2.inwardNumber \
                                                            , t2.amount \
                                                            , t3.currency \
                                                            , t1.subscriptionDate \
                                                    from subscription t1 left join inward t2 on t1.inwardID = t2.id \
                                                    left join currency t3 on t2.currency = t3.id \
                                                    left join subscriber t4 on t1.subscriberID = t4.id \
                                                    where t4.subscriberNumber = ? ) as t5 \
                                                left join (subscriptiondetails t6, subscription_rates t7 ) on t5.id=t6.subscriptionID \
                                                and t6.journalPriceGroupID = t7.id \
                                                and t6.active = true \
                                                group by t5.id, t5.inwardNumber, t5.amount \
                                                order by t5.id desc \
                                            ) \
                                        t8 left join payment t9 on t8.id = t9.subscriptionID \
                                        left join inward t10 on t9.inwardID=t10.id \
                                        group by t8.id,t8.inwardNumber \
                                        order by t8.id desc


get_subscription_info_by_id =   select t6.id,\
                                    t6.subscriberName,\
                                    t6.inwardNumber,\
                                    sum(t6.amount + COALESCE(t8.amount,0)) as amount,\
                                    sum(t6.subscriptionTotal) as subscriptionTotal,\
                                    (sum(t6.subscriptionTotal) - sum(t6.amount + COALESCE(t8.amount,0))) as balance,\
                                    t6.remarks,\
                                    t6.subscriberNumber \
                                from \
                                ( \
                                select  t1.id,\
                                        t3.subscriberName,\
                                        t2.inwardNumber,\
                                        ((t5.rate * t4.copies) - t2.amount) as balance,\
                                        (t5.rate * t4.copies)  as subscriptionTotal,\
                                        t1.remarks,\
                                        t2.amount,\
                                        t3.subscriberNumber \
                                from  subscription t1,\
                                    inward t2,\
                                    subscriber t3,\
                                    subscriptiondetails t4,\
                                    subscription_rates t5 \
                                where t1.inwardID = t2.id \
                                    and t1.subscriberID = t3.id \
                                    and t4.subscriptionID = t1.id \
                                    and t4.journalPriceGroupID = t5.id \
                                    and t4.active=true \
                                    and t1.id = ? \
                                ) t6  left join payment t7 on t6.id = t7.subscriptionID \
                                    left join inward t8 on t7.inwardID = t8.id \
                                    group by t6.id, t6.subscriberName, t6.inwardNumber, t6.subscriberNumber

get_subscription_detail_by_subscription_id =    select t2.id \
                                , t3.journalGroupName as journalGroupName \
                                , t2.journalGroupID \
                                , t2.startYear \
                                , t2.startMonth \
                                , t2.endYear \
                                , t2.copies \
                                , (t2.copies * t4.rate) as total \
                                , (select rate from subscription_rates where id=t2.journalPriceGroupID) as journalGroupCost\
                                , t2.active \
                            from subscription t1 \
                                , subscriptiondetails t2 \
                                , journal_groups t3 \
                                , subscription_rates t4 \
                            where t1.id = t2.subscriptionID \
                                and t2.journalGroupID = t3.id \
                                and t2.journalPriceGroupID = t4.id \
                                and t1.id = ? \
                                order by t2.id asc

#insert_subscription = insert into subscription(subscriberID,inwardID,balance,subscriptionDate,subscriptionTotal,remarks) \
#                     values ((select id from subscriber where subscriberNumber=?),(select id from inward where inwardNumber=?),?,?,?,?)

insert_subscription = insert into subscription(subscriberID,inwardID,subscriptionDate,remarks) \
                      values ((select id from subscriber where subscriberNumber=?), \
                                (select id from inward where inwardNumber=?),?,?)

#insert_subscription_detail = insert into subscriptiondetails ( \
#                            subscriptionID,journalGroupID,journalPriceGroupID,copies,startYear,endYear,total) \
#                            values (?, ?, ?, ?, ?, ?, ?)

insert_subscription_detail = insert into subscriptiondetails ( \
                            subscriptionID,journalGroupID,journalPriceGroupID,copies,startYear,startMonth,endYear) \
                            values (?, ?, ?, ?, ?, ?, ?)


delete_subscription = update subscription set active = false where id=?


get_subscription_details =  select t1.id, t2.journalGroupName, t1.copies \
                            , t1.startYear, t1.endYear, (t1.copies * t3.rate) as total \
                            , t1.active \
                            from subscriptiondetails t1, journal_groups t2, subscription_rates t3 \
                            where t1.journalGroupID = t2.id \
                            and t1.journalPriceGroupID = t3.id \
                            and t1.subscriptionID = ?

get_journal_group_price = select id, rate from subscription_rates where journalGroupId = ? and subtypeid = ? \
                            and year = ? and period = ?

get_journal_groupid_contents = select t1.journalname from journals t1,journal_group_contents t2 \
                                where t2.journalId = t1.id and t2.journalGroupId = ?;

get_subscription_details_for_inward = select t1.id as subscriptionid, t4.journalName, t2.startYear, t2.endYear, t2.copies \
                                      from  subscription t1, \
                                            subscriptiondetails t2, \
                                            journal_group_contents t3, \
                                            journals t4, \
                                            inward t5 \
                                      where t1.active=true \
                                            and t1.id=t2.subscriptionID \
                                            and t2.journalGroupID = t3.journalGroupID \
                                            and t3.journalID = t4.id \
                                            and t1.inwardID = t5.id \
                                            and t5.inwardNumber = ? \
                                      group by subscriptionid, t4.journalName

update_subscription_detail =    update subscriptiondetails set startYear=?, startMonth=?, endYear=?, \
                                journalPriceGroupID=? , copies=?, active=? \
                                where id=?;

update_subscription_balance = update subscription set subscriptionTotal=?, balance=? where id = ?

get_active_subscription_total_amount = select t1.subscriptionTotal,t2.amount from subscription t1, inward t2 where \
                                       t1.inwardID = t2.id and t1.id=?
#--------------------------------------------------------------------------
# Reports
#--------------------------------------------------------------------------

!List Subscriber Type ---------------------------------------------

search_subtype_all = select id, subtypecode, subtypedesc, subtype, nationality, institutional, freejrnl, discount from subscriber_type order by id

search_subtype_prm = select id, subtypecode, subtypedesc, subtype, nationality, institutional, freejrnl, discount from subscriber_type where
!End List Subscriber Type ---------------------------------------------

!List Inward ---------------------------------------------
search_inward = select inwardNumber, t4.subscriberNumber as subscriberId, t1.from, DATE_FORMAT(inwardCreationDate,'%d/%m/%Y') as inwardCreationDate, t2.city as city, chqddNumber, t3.purpose as inwardPurpose, \
                t1.inwardPurpose as inwardPurposeID from inward t1 \
                left join cities t2 on t1.city = t2.id \
                left join inward_purpose t3 on t1.inwardPurpose = t3.id \
                left join subscriber t4 on t1.subscriberId = t4.id \
                left join currency t5 on t1.currency = t5.id \
                left join payment_mode t6 on t1.paymentMode = t6.id \
                left join countries t7 on t1.country = t7.id \
                left join states t8 on t1.state = t8.id \
                where inwardNumber is not NULL

!End List Inward ---------------------------------------------

!List Journal ---------------------------------------------

list_journal_all = select id, journalCode, journalName, issnNo, pages, startYear, issues from journals

list_journal_group = select  t1.id, t1.journalCode, t1.journalName, t1.issnNo, t1.pages, t1.startYear, \
                     t1.issues from journals t1, journal_groups t2, journal_group_contents t3 where t1.id = \
                      t3.journalid and t2.id = t3.journalGroupId and
!End List Journals ---------------------------------------------

!List Agents ---------------------------------------------

list_agent_all = select t1.id\
                    ,t1.agentName \
                    ,t1.regDate \
                    ,t1.emailId \
                    ,t1.address \
                    ,t2.city \
                    ,t3.district \
                    ,t4.state \
                    ,t5.country \
                    ,t1.pinCode \
                    ,t1.discount \
                    from agents t1 \
                    left join cities t2 on t1.cityId = t2.id \
                    left join districts t3 on t1.districtId = t3.id \
                    left join states t4 on t1.stateId = t4.id \
                    left join countries t5 on t1.countryId = t5.id

list_agent_prm = select t1.id\
                    ,t1.agentName \
                    ,t1.regDate \
                    ,t1.emailId \
                    ,t1.address \
                    ,t2.city \
                    ,t3.district \
                    ,t4.state \
                    ,t5.country \
                    ,t1.pinCode \
                    ,t1.discount \
                    from agents t1 \
                    left join cities t2 on t1.cityId = t2.id \
                    left join districts t3 on t1.districtId = t3.id \
                    left join states t4 on t1.stateId = t4.id \
                    left join countries t5 on t1.countryId = t5.id \
                    where
!End List Agents ---------------------------------------------

!Circulation Figures ---------------------------------------------

list_circulation_figures = select journalCode, journalName, instIndia, instAbroad, indiAbroad, indiIndia, \
                            comp, totalCopies, auth, printOrder, balanceCopies from circulation_figure
!End Cisrculation Figures ---------------------------------------------

!statement ---------------------------------------------

statement = select journals.journalCode, journals.journalName, subscriber_type.subtypecode, sum(subscriptiondetails.copies) as copies, count(subscriber.id) as subscriberCount \
            from subscriptiondetails left join subscription on subscriptiondetails.subscriptionID = subscription.id \
            left join subscriber on subscription.subscriberID = subscriber.id \
            left join subscriber_type on subscriber.subtype = subscriber_type.id \
            left join journal_groups on subscriptiondetails.journalGroupID = journal_groups.id \
            right join journal_group_contents on journal_group_contents.journalGroupId = journal_groups.id \
            left join journals on journal_group_contents.journalId = journals.id \
            where 
!End statement ---------------------------------------------

!Circulation Figures ---------------------------------------------

rep_sub_rate = select journalGroupName, subTypeDesc, `year`, year1, year2, year3, year4 from temp_sub_rate
!End Cisrculation Figures ---------------------------------------------

#--------------------------------------------------------------------------
# End Reports
#--------------------------------------------------------------------------

#--------------------------------------------------------------------------
# Invoice
#--------------------------------------------------------------------------
get_last_invoice = SELECT invoiceNumber FROM invoice where YEAR(invoiceCreationDate)=YEAR(CURDATE()) ORDER BY id DESC LIMIT 1

invoice_insert = insert into invoice ( invoiceNumber, subscriptionID, invoiceCreationDate ) values ( ?, ?, ? )

get_invoice_detail = SELECT t1.id as inwardID, \
                            t1.inwardNumber, \
                            t3.subscriberName, \
                            t3.email, \
                            t2.id as subscriptionID, \
                            t2.subscriberID, \
                            t3.shippingAddress, \
                            t3.invoiceAddress, \
                            t4.invoiceNumber, \
                            DATE_FORMAT(t4.invoiceCreationDate,'%d/%m/%Y') as invoiceCreationDate, \
                            sum(t6.rate * t5.copies)  as subscriptionTotal \
                                    from inward t1, subscription t2, subscriber t3, invoice t4, \
                                    subscriptiondetails t5, subscription_rates t6 \
                            where t1.inwardNumber = ? \
                                and t2.inwardID = t1.id \
                                and t3.id = t2.subscriberID \
                                and t4.subscriptionID = t2.id \
                                and t5.subscriptionID = t2.id \
                                and t5.journalPriceGroupID = t6.id \


search_subscriber_invoice = select  t5.invoiceNumber, \
                                    DATE_FORMAT(t5.invoiceCreationDate,'%d/%m/%Y') as invoiceCreationDate, \
                                    t2.id as subscriptionID, \
                                    sum(t3.copies * t4.rate) as invoiceAmount \
                            from  subscriber t1, \
                                subscription t2, \
                                subscriptiondetails t3, \
                                subscription_rates t4, \
                                invoice t5 \
                            where t1.id=t2.subscriberID \
                                and t3.subscriptionID=t2.id \
                                and t3.journalPriceGroupID=t4.id \
                                and t2.id=t5.subscriptionId \
                                and t1.subscriberNumber=? \
                            group by t5.invoiceNumber, t5.invoiceCreationDate,t2.id \
                            order by subscriptionID desc \


get_invoice_detail_usng_invno =  Select  t5.id, \
                                 DATE_FORMAT(t5.invoiceCreationDate,'%d/%m/%Y') as invoiceCreationDate, \
                                 t2.id as subscriptionID, \
                                 t6.inwardNumber, \
                                 t1.shippingAddress, \
                                 t1.invoiceAddress, \
                                 sum(t3.copies * t4.rate) as subscriptionTotal \
                                        from  subscriber t1, \
                                              subscription t2, \
                                              subscriptiondetails t3, \
                                              subscription_rates t4, \
                                              invoice t5, \
                                              inward t6 \
                                            where t1.id=t2.subscriberID \
                                                and t3.subscriptionID=t2.id \
                                                and t3.journalPriceGroupID=t4.id \
                                                and t2.id=t5.subscriptionId \
                                                and t6.id=t2.inwardID \
                                                and t5.invoiceNumber = ?




#--------------------------------------------------------------------------
# Start Mailing List
#--------------------------------------------------------------------------

getissues = Select issueNumber from issues where issues.issueNumber <= (select issues from journals where journalName = ?)

select_generateml =   Select \
                    subscriber.id, subscription.id, subscriptiondetails.id, journals.id, journals.journalCode, \
                    subscriber_type.subtypecode, subscriber.subscriberNumber, subscriber.subscriberName, subscriber.department, subscriber.institution, \
                    subscriber.shippingAddress, cities.city, districts.district, states.state, countries.country, \
                    subscriber.pincode, subscriptiondetails.copies, subscriptiondetails.startYear, subscriptiondetails.startMonth, \
                    subscriptiondetails.endYear, subscriptiondetails.endMonth \
                    from \
                    subscriptiondetails left join subscription on subscriptiondetails.subscriptionID = subscription.id \
                    left join subscriber on subscription.subscriberID = subscriber.id \
                    left join subscriber_type on subscriber.subtype = subscriber_type.id \
                    left join journal_groups on subscriptiondetails.journalGroupID = journal_groups.id \
                    right join journal_group_contents on journal_group_contents.journalGroupId = journal_groups.id \
                    left join journals on journal_group_contents.journalId = journals.id \
                    left join cities on subscriber.city = cities.id \
                    left join countries on subscriber.country = countries.id \
                    left join districts on subscriber.district = districts.id \
                    left join states on subscriber.state = states.id \
                    where subscriptiondetails.active = '1' \
                    and journals.journalName = ? and subscriptiondetails.endYear >= ? and subscriptiondetails.startYear <= ?

insert_ml = insert into mailing_list (journalId, issue, `year`, month) values \
            ((select id from journals where journals.journalName = ?),?,?,(select id from months where months.month = ?))

insert_mldtl = insert into mailing_list_detail (mailinglistId, subscriberId, subscriptionId, subscriptionDetailId, \
                journalId, journalCode, subtypecode, subscriberNumber, subscriberName, department, institution, address, city, district, state, \
                country, pincode, copies, startYear, startMonth, endYear, endMonth, issue, month, `year`) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, \
                (select id from months where months.month = ?), ?)

search_ml =select journalId, issue, `year`, month, mlDate FROM mailing_list where journalId = ? AND issue = ? AND `year` = ? \
            AND month = ? and bilid = ' '

get_ml =select id, journalId, issue, `year`, month, mlDate FROM mailing_list where \
                journalId =  (select id from journals where journals.journalName = ?) \
        and issue = ?

check_ml =select id FROM mailing_list where \
                journalId =  (select id from journals where journals.journalName = ?) \
                and issue = ?

search_mldtl = select id, journalCode, subtypecode, subscriberNumber, subscriberName, department , institution, \
                address, city, district, state, country, pincode, copies, issue, month, `year`, startYear, startMonth, endYear, endMonth \
                FROM mailing_list_detail where mailinglistid = ?

get_ml_id = select id from mailing_list where journalId = (select id from journals where journals.journalName = ?) and \
             issue = ? and `year` = ? and month = (select id from months where months.month = ?)
#--------------------------------------------------------------------------
# End Mailing List
#--------------------------------------------------------------------------

#--------------------------------------------------------------------------
# Start Back Issue List
#--------------------------------------------------------------------------
subscribernumber =  select subscriber.subscriberNumber \
                    from  subscriber,\
                        back_issue_list,\
                        subscription,\
                        subscriptiondetails \
                    where back_issue_list.subscription_detail_id = subscriptiondetails.id \
                        and back_issue_list.sent_to_subscriber = false \
                        and subscriptiondetails.subscriptionID = subscription.id \
                        and subscription.subscriberID = subscriber.id \
                    group by subscriber.subscriberNumber

subscribernumberbil =   select subscriber.subscriberNumber \
                        from  subscriber,\
                            back_issue_list, \
                            subscription, \
                            subscriptiondetails \
                        where back_issue_list.subscription_detail_id = subscriptiondetails.id \
                            and back_issue_list.sent_to_subscriber = true \
                            and subscriptiondetails.subscriptionID = subscription.id \
                            and subscription.subscriberID = subscriber.id \
                        group by subscriber.subscriberNumber


generate_bil = select   mailing_list.id, \
                        subscriber.id, \
                        subscription.id, \
                        subscriptiondetails.id, \
			journals.id, \
			journals.journalCode, \
                        subscriber_type.subtypecode, \
                        subscriber.subscriberNumber, \
			subscriber.subscriberName, \
                        subscriber.department, \
			subscriber.institution, \
			subscriber.shippingAddress, \
                        cities.city, \
			districts.district, \
			states.state, \
                        countries.country, \
                        subscriber.pincode, \
                        back_issue_list.copies, \
                        subscriptiondetails.startYear, \
                        subscriptiondetails.startMonth, \
                        subscriptiondetails.endYear, \
                        subscriptiondetails.endMonth, \
                        back_issue_list.issue_number, \
                        back_issue_list.month, \
                        back_issue_list.`year`, \
                        back_issue_list.id \
                FROM  back_issue_list, \
                        mailing_list, \
                        subscriptiondetails left join subscription on subscriptiondetails.subscriptionID = subscription.id \
                        left join subscriber on subscription.subscriberID = subscriber.id \
                        left join subscriber_type on subscriber.subtype = subscriber_type.id \
                        left join journal_groups on subscriptiondetails.journalGroupID = journal_groups.id \
                        right join journal_group_contents on journal_group_contents.journalGroupId = journal_groups.id \
                        left join journals on journal_group_contents.journalId = journals.id \
                        left join cities on subscriber.city = cities.id \
                        left join states on subscriber.state = states.id \
                        left join countries on subscriber.country = countries.id \
                        left join districts on subscriber.district = districts.id \
                        where back_issue_list.`year` = mailing_list.`year` \
                       and back_issue_list.issue_number = mailing_list.issue \
                        and back_issue_list.month = mailing_list.month \
                        and back_issue_list.sent_to_subscriber = false \
                        and back_issue_list.subscription_detail_id = subscriptiondetails.id \
                        and back_issue_list.journal_id = journals.id \
                        and mailing_list.journalId = journals.id \
                        and subscriptiondetails.active = true \
                        and subscriber.subscriberNumber = ?

insert_mldtl_bil = insert into mailing_list_detail \
                    ( mailinglistId, subscriberId, subscriptionId, subscriptionDetailId, journalId, journalCode, \
                    subtypecode, subscriberNumber, subscriberName, department, institution, address, city, district, \
                    state, country, pincode, copies, startYear, startMonth, endYear, endMonth, issue, month, \
                    `year`, bilid, bildate) \
                    VALUES \
                    ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, \
                    ?, ?, ?, ? )

update_bil = update back_issue_list SET sent_to_subscriber = true WHERE Id = ?

search_bil = select \
            mailing_list_detail.journalCode, mailing_list_detail.subtypecode, mailing_list_detail.subscriberNumber, \
            mailing_list_detail.subscriberName, mailing_list_detail.department, \
            mailing_list_detail.institution, mailing_list_detail.address, mailing_list_detail.city, mailing_list_detail.district, \
            mailing_list_detail.state, mailing_list_detail.country, mailing_list_detail.pincode, mailing_list_detail.copies, \
            mailing_list_detail.startYear, mailing_list_detail.startMonth, mailing_list_detail.endYear, mailing_list_detail.issue, \
            mailing_list_detail.endMonth, mailing_list_detail.month, mailing_list_detail.`year`, mailing_list_detail.bildate \
            FROM \
            mailing_list_detail, subscriptiondetails \
            where mailing_list_detail.subscriptionDetailId = subscriptiondetails.id and subscriptiondetails.active = '1' \
            and  mailing_list_detail.startYear >= subscriptiondetails.startYear and subscriberNumber = ? \
            and bilid <> ' ' group by bildate

#--------------------------------------------------------------------------
# End Back Issue List
#--------------------------------------------------------------------------

# -------------------------------------------------------------------------
#Reminders
#--------------------------------------------------------------------------
search_reminders_subscriber =  select subscriber.id, subscription.id as subId, subscriber_type.subtypecode, subscriber.subscriberNumber, \
                                subscriber.subscriberName, reminders.balance, reminders.reminderType, reminders.reminderDate, \
                                 subscriber.department, subscriber.institution, subscriber.shippingAddress, \
                                cities.city, districts.district, states.state, countries.country, subscriber.pincode, \
                                subscriber.email \
                                from reminders, subscription, \
                                subscriber left join cities on subscriber.city = cities.id \
                                left join states on subscriber.state = states.id \
                                left join countries on subscriber.country = countries.id \
                                left join districts on subscriber.district = districts.id, subscriber_type \
                                where \
                                subscription.subscriberID = subscriber.id and reminders.subscriptionId = subscription.id \
                                and subscriber.subtype = subscriber_type.id and year(reminders.reminderDate)= year(curdate()) \
                                and reminders.reminderType = ?

get_reminders_subscriber =  select subscriber.id, subscription.id as subId, subscriber_type.subtypecode, subscriber.subscriberNumber, \
                                subscriber.subscriberName, reminders.balance, reminders.reminderType, reminders.reminderDate, \
                                 subscriber.department, subscriber.institution, subscriber.shippingAddress, \
                                cities.city, districts.district, states.state, countries.country, subscriber.pincode, \
                                subscriber.email \
                                from reminders, subscription, \
                                subscriber left join cities on subscriber.city = cities.id \
                                left join states on subscriber.state = states.id \
                                left join countries on subscriber.country = countries.id \
                                left join districts on subscriber.district = districts.id, subscriber_type \
                                where \
                                subscription.subscriberID = subscriber.id and reminders.subscriptionId = subscription.id \
                                and subscriber.subtype = subscriber_type.id and year(reminders.reminderDate)= year(curdate()) \
                                and reminders.reminderType = ? and reminders.reminderDate = curdate();

send_email_reminders =  select subscriber.id, subscription.id as subId, subscriber_type.subtypecode, subscriber.subscriberNumber, \
                                subscriber.subscriberName, reminders.balance, reminders.reminderType, reminders.reminderDate, \
                                 subscriber.department, subscriber.institution, subscriber.shippingAddress, \
                                cities.city, districts.district, states.state, countries.country, subscriber.pincode, \
                                subscriber.email \
                                from reminders, subscription, \
                                subscriber left join cities on subscriber.city = cities.id \
                                left join states on subscriber.state = states.id \
                                left join countries on subscriber.country = countries.id \
                                left join districts on subscriber.district = districts.id, subscriber_type \
                                where \
                                subscription.subscriberID = subscriber.id and reminders.subscriptionId = subscription.id \
                                and subscriber.subtype = subscriber_type.id and year(reminders.reminderDate)= year(curdate()) \
                                and reminders.reminderType = ? and reminders.reminderDate = curdate() and subscriber.email <> " "

send_print_reminders =  select subscriber.id, subscription.id as subId, subscriber_type.subtypecode, subscriber.subscriberNumber, \
                                subscriber.subscriberName, reminders.balance, reminders.reminderType, reminders.reminderDate, \
                                 subscriber.department, subscriber.institution, subscriber.shippingAddress, \
                                cities.city, districts.district, states.state, countries.country, subscriber.pincode, \
                                subscriber.email \
                                from reminders, subscription, \
                                subscriber left join cities on subscriber.city = cities.id \
                                left join states on subscriber.state = states.id \
                                left join countries on subscriber.country = countries.id \
                                left join districts on subscriber.district = districts.id, subscriber_type \
                                where \
                                subscription.subscriberID = subscriber.id and reminders.subscriptionId = subscription.id \
                                and subscriber.subtype = subscriber_type.id and year(reminders.reminderDate)= year(curdate()) \
                                and reminders.reminderType = ? and reminders.reminderDate = curdate() and subscriber.email = " "

insert_reminder_details = insert into reminder_details ( reminderId, medium, language sent_date) \
                            VALUES (?, ?, ?, curdate())

get_subscribed_journals = select journals.journalCode, journals.journalName, journal_groups.journalGroupName, \
                            subscriptiondetails.copies, subscriptiondetails.startYear, subscriptiondetails.startMonth, \
                            subscriptiondetails.endMonth, subscriptiondetails.endYear \
                            from reminders, subscription, subscriptiondetails, journal_group_contents, journal_groups, journals \
                            where reminders.subscriptionId = subscription.id and subscriptiondetails.subscriptionID = subscription.id \
                            and subscriptiondetails.journalGroupID = journal_groups.id and journal_group_contents.journalGroupId = journal_groups.id \
                            and journal_group_contents.journalId = journals.id and subscriptiondetails.active = 1 \
                            and reminders.id = ?
#------------------------------------------------------------------------------
#End Reminders
#------------------------------------------------------------------------------

#--------------------------------------------------------------------------
# Missing Issue List
#--------------------------------------------------------------------------
insert_missing_issue = insert into missing_issue ( inwardId, subscriberId,msEntryDate ) \
                        VALUES ( (select id from inward where inward.inwardNumber = ?), \
                        (select id from subscriber where subscriber.subscriberNumber = ?), curdate())

insert_missing_journals = insert into missing_issue_journals ( missingissueId, subscriptiondetailId, journalGroupId, journalId, month, `year`, missingCopies ) \
                            VALUES ( ?, \
                            (select subscriptiondetails.id from subscriptiondetails, journal_groups where \
                                subscriptiondetails.subscriptionID = ? \
                                 and subscriptiondetails.journalGroupID =  journal_groups.id and \
                                    journal_groups.journalGroupName = ?), \
                              (select id from journal_groups where journal_groups.journalGroupName = ?), \
                              (select id from journals where journalName = ?), \
                            (select id from months where month = ?), ?, ?)


get_subscriptionid = select subscription.id from subscription, subscriber where \
                        subscription.subscriberID = subscriber.id and subscriber.subscriberNumber = ?

get_journalgroup = select journal_groups.journalGroupName from journal_groups, subscriptiondetails \
                    where subscriptiondetails.journalGroupID = journal_groups.id and subscriptiondetails.subscriptionID = ? \
                    and subscriptiondetails.active = 1 and subscriptiondetails.endYear >= year(curdate())

get_journalname = select journalName from journals, journal_group_contents, journal_groups \
                    where journal_group_contents.journalGroupId = journal_groups.id and journal_group_contents.journalId = journals.id \
                and journal_groups.journalGroupName = ?

get_copies = select subscriptiondetails.copies from subscriptiondetails, journal_groups \
            where subscriptiondetails.journalGroupID = journal_groups.id \
            and journal_groups.journalGroupName = ? and subscriptiondetails.subscriptionID = ?

get_missing_journals = select subscriptiondetails.id, journal_groups.journalGroupName, journals.journalCode, \
                        journals.journalName, subscriptiondetails.copies, missing_issue_journals.month, \
                        missing_issue_journals.`year`, missing_issue_journals.missingCopies, \
                        subscriptiondetails.startYear, subscriptiondetails.endMonth, subscriptiondetails.startMonth, \
                        subscriptiondetails.endYear \
                        from missing_issue_journals, subscriptiondetails, journal_groups, journals \
                        where missing_issue_journals.subscriptiondetailId = subscriptiondetails.id \
                        and missing_issue_journals.journalGroupId = journal_groups.id \
                        and missing_issue_journals.journalId = journals.id and missing_issue_journals.missingissueId = ?

get_subscriber_detail = select subscriber.subscriberName, subscriber.department, subscriber.institution, \
                        subscriber.shippingAddress, cities.city, districts.district, states.state, \
                        countries.country, subscriber.pincode, subscriber.email, subscriber_type.subtypedesc \
                        from subscriber left join states on subscriber.state = states.id \
                        left join cities on subscriber.city = cities.id \
                        left join countries on subscriber.country = countries.id \
                        left join districts on subscriber.district = districts.id \
                        left join subscriber_type on subscriber.subtype = subscriber_type.id \
                        where subscriber.subscriberNumber = ?

complete_inward = update inward set completed = true where inwardNumber = ?

update_missing_action = update missing_issue_journals SET action = ?, sentOn = curdate() WHERE missingissueId = ?

reprint_mi_list = select mailing_list_detail.id, mailing_list_detail.mailinglistId, mailing_list_detail.subscriberId, \
                mailing_list_detail.subscriptionId, mailing_list_detail.subscriptionDetailId, mailing_list_detail.journalId, \
                mailing_list_detail.journalCode, mailing_list_detail.subtypecode, mailing_list_detail.subscriberNumber, \
                mailing_list_detail.subscriberName, mailing_list_detail.department, mailing_list_detail.institution, \
                mailing_list_detail.address, mailing_list_detail.city, mailing_list_detail.district, mailing_list_detail.state, \
                mailing_list_detail.country, mailing_list_detail.pincode, mailing_list_detail.copies, mailing_list_detail.startYear, \
                mailing_list_detail.startMonth, mailing_list_detail.endYear, mailing_list_detail.issue, mailing_list_detail.endMonth, \
                mailing_list_detail.month, mailing_list_detail.`year` \
                from missing_issue_journals, mailing_list_detail \
                where mailing_list_detail.journalId = missing_issue_journals.journalId \
                and mailing_list_detail.subscriptionDetailId = missing_issue_journals.subscriptiondetailId \
                and mailing_list_detail.month = missing_issue_journals.month and mailing_list_detail.`year`= missing_issue_journals.`year` \
                and missing_issue_journals.missingissueId = ?

generate_ml = select mailing_list.id, subscriber.id, subscription.id, subscriptiondetails.id, journals.id, \
                journals.journalCode,subscriber_type.subtypecode, subscriber.subscriberNumber, subscriber.subscriberName, \
                subscriber.department, subscriber.institution, subscriber.shippingAddress, cities.city, districts.district, \
                states.state, countries.country, subscriber.pincode, missing_issue_journals.missingCopies, subscriptiondetails.startYear, \
                subscriptiondetails.startMonth, subscriptiondetails.endYear, subscriptiondetails.endMonth, \
                mailing_list.issue, missing_issue_journals.month, \
                missing_issue_journals.`year`, missing_issue_journals.id \
                from mailing_list, missing_issue_journals, missing_issue, \
                subscriptiondetails, subscription, journals, subscriber_type, \
                subscriber left join cities on subscriber.city = cities.id \
                left join states on subscriber.state = states.id \
                left join countries on subscriber.country = countries.id \
                left join districts on subscriber.district = districts.id \
                where \
                mailing_list.journalId = journals.id \
                and missing_issue_journals.journalId = journals.id \
                and missing_issue_journals.journalId = mailing_list.journalId \
                and missing_issue_journals.subscriptiondetailId = subscriptiondetails.id \
                and missing_issue_journals.month = mailing_list.month and missing_issue_journals.`year` = mailing_list.`year` \
                and subscriptiondetails.subscriptionID = subscription.id and subscription.subscriberID = subscriber.id \
                and missing_issue_journals.subscriptiondetailId = subscriptiondetails.id and missing_issue.subscriberId = subscriber.id \
                and missing_issue_journals.missingissueId = missing_issue.id \
                and subscriber.subtype = subscriber_type.id and missing_issue_journals.missingissueId = ?

insert_mldtl_mil = insert into mailing_list_detail \
                    ( mailinglistId, subscriberId, subscriptionId, subscriptionDetailId, journalId, journalCode, \
                    subtypecode, subscriberNumber, subscriberName, department, institution, address, city, district, \
                    state, country, pincode, copies, startYear, startMonth, endYear, endMonth, issue, month, \
                    `year`, miId, bildate) \
                    VALUES \
                    ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, \
                    ?, ?, ?, curdate())

get_month_mi = select months.month from months, mailing_list, journals \
            where mailing_list.journalId = journals.id \
                and mailing_list.month = months.id and journals.journalName = ? and mailing_list.`year` = ?

get_miId_for_inward = Select missing_issue.id, subscriber.subscriberNumber \
                        FROM missing_issue, inward, subscriber \
                        where \
                        missing_issue.inwardId = inward.id \
                        and missing_issue.subscriberId = subscriber.id and inward.inwardNumber = ?
#--------------------------------------------------------------------------
# End Missing Issue List
#-------------------------------------- --   ----------------------------------